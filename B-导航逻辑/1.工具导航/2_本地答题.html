<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç­”é¢˜åŠ©æ‰‹</title>
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶å·¥å…·/6.æ’ä»¶_è·³è½¬ä¾¿ç­¾.js"></script>
    <style>
        /* å¤ç”¨å‰ªè´´æ¿ç®¡å®¶çš„æ ·å¼*/
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #5e72e4;
            --secondary-color: #f5365c;
            --success-color: #2dce89;
            --warning-color: #fb6340;
            --info-color: #11cdef;
            --dark: #32325d;
            --light: #f8f9fe;
            --border-radius: 6px;
            --transition: all 0.3s ease;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 1.5s ease;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 30px;
            animation: slideIn 0.5s ease;
            backdrop-filter: blur(10px);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .title {
            font-size: 24px;
            color: var(--dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: white;
            white-space: nowrap;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .btn-primary { background: var(--primary-color); }
        .btn-success { background: var(--success-color); }
        .btn-warning { background: var(--warning-color); }
        .btn-info { background: var(--info-color); }
        .progress {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }
        .question {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .options {
            list-style: none;
        }
        .options li {
            background: #f0f0f0;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .options li:hover:not(.disabled) {
            background: var(--primary-color);
            color: white;
            transform: translateX(10px);
        }
        .options li.selected {
            background: var(--info-color);
            color: white;
        }
        .options li.correct {
            background: var(--success-color);
            color: white;
            animation: pulse 0.5s ease;
        }
        .options li.incorrect {
            background: var(--secondary-color);
            color: white;
            animation: shake 0.5s ease;
        }
        .options li.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .options li .icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: var(--info-color);
            transform: scale(1.05);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            display: none;
        }
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .feedback.correct {
            background: #c8e6c9;
            color: #2e7d32;
        }
        .feedback.incorrect {
            background: #ffcdd2;
            color: #c62828;
        }
        .continue-btn {
            background: var(--success-color);
            margin-top: 10px;
            display: none;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #868e96;
        }
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.6;
        }
        .empty-title {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        .empty-text {
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .template-box {
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            margin-bottom: 15px;
        }
        .modal-title {
            font-size: 18px;
            color: var(--dark);
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            font-size: 14px;
            transition: var(--transition);
            min-height: 200px;
            resize: vertical;
            font-family: monospace;
        }
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1);
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
            font-size: 14px;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast.success { border-left: 3px solid var(--success-color); }
        .toast.error { border-left: 3px solid var(--secondary-color); }
        .toast.info { border-left: 3px solid var(--info-color); }
        .completion-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--info-color) 100%);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
        }
        .completion-title {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .completion-text {
            font-size: 18px;
            margin-bottom: 20px;
        }
        .completion-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }
        .template-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        .template-item {
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        .template-item:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }
        .template-item h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }
        .template-item p {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        .template-actions {
            display: flex;
            gap: 10px;
        }
        .template-actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .import-format-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        .format-tab {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background: none;
            color: #666;
            font-size: 14px;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        .format-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .format-tab:hover {
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">ğŸ§ æ™ºèƒ½ç­”é¢˜åŠ©æ‰‹</h1>
            <div class="controls">
                <button class="btn btn-info" onclick="showTemplateModal()">
                    <span>ğŸ“</span> æ¨¡æ¿æ¡ˆä¾‹
                </button>
                <button class="btn btn-primary" onclick="openImportModal()">
                    <span>ğŸ“‚</span> å¯¼å…¥æ–‡ä»¶
                </button>
                <button class="btn btn-warning" onclick="clearAll()">
                    <span>ğŸ—‘ï¸</span> æ¸…ç©ºå†…å®¹
                </button>
            </div>
        </header>
        <main id="mainContent">
            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ-->
        </main>
    </div>

    <!-- æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†-->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">é€‰æ‹©ç­”é¢˜æ¨¡æ¿</h2>
            </div>
            <div class="template-list">
                <div class="template-item">
                    <h4>ğŸŒŸåŸºç¡€æ¨¡æ¿</h4>
                    <p>åŒ…å«3é“åŸºç¡€é¢˜ç›®ï¼Œé€‚åˆåˆå­¦è€…</p>
                    <div class="template-actions">
                        <button class="btn btn-primary" onclick="loadTemplate('basic')">åŠ è½½æ¨¡æ¿</button>
                        <button class="btn btn-info" onclick="copyTemplate('basic')">å¤åˆ¶ä»£ç </button>
                    </div>
                </div>
                <div class="template-item">
                    <h4>ğŸ’»ç¼–ç¨‹æ¨¡æ¿</h4>
                    <p>åŒ…å«5é“ç¼–ç¨‹ç›¸å…³é¢˜ç›®</p>
                    <div class="template-actions">
                        <button class="btn btn-primary" onclick="loadTemplate('programming')">åŠ è½½æ¨¡æ¿</button>
                        <button class="btn btn-info" onclick="copyTemplate('programming')">å¤åˆ¶ä»£ç </button>
                    </div>
                </div>
                <div class="template-item">
                    <h4>ğŸ”¬ç§‘å­¦æ¨¡æ¿</h4>
                    <p>åŒ…å«4é“ç§‘å­¦çŸ¥è¯†é¢˜ç›®</p>
                    <div class="template-actions">
                        <button class="btn btn-primary" onclick="loadTemplate('science')">åŠ è½½æ¨¡æ¿</button>
                        <button class="btn btn-info" onclick="copyTemplate('science')">å¤åˆ¶ä»£ç </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="background: #6c757d;" onclick="closeTemplateModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥æ¨¡æ€æ¡†-->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å¯¼å…¥é¢˜ç›®æ•°æ®</h2>
            </div>
            <div class="import-format-tabs">
                <button class="format-tab active" onclick="switchFormat('json')">JSON æ ¼å¼</button>
                <button class="format-tab" onclick="switchFormat('js')">JavaScript æ ¼å¼</button>
            </div>
            <div class="form-group">
                <label class="form-label">ç²˜è´´é¢˜ç›®æ•°æ®</label>
                <textarea class="form-textarea" id="importData" placeholder="æ”¯æŒJSONæ ¼å¼å’ŒJavaScriptæ ¼å¼..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="importData()">å¯¼å…¥</button>
                <button class="btn" style="background: #6c757d;" onclick="closeImportModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // éšæœºæ¸å˜èƒŒæ™¯æ•°ç»„- 25 ç§
        const gradients = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', 'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)', 'linear-gradient(135deg, #fdcbf1 0%, #e6dee9 100%)', 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)', 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)', 'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)', 'linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)', 'linear-gradient(135deg, #9890e3 0%, #b1f4cf 100%)',
            'linear-gradient(135deg, #ebc0fd 0%, #d9ded8 100%)', 'linear-gradient(135deg, #96fbc4 0%, #f9f586 100%)', 'linear-gradient(135deg, #f6d365 0%, #fda085 100%)', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
        ];

        // æ¨¡æ¿æ•°æ®
        const templates = {
            basic: [
                { question: "HTML æ˜¯ä»€ä¹ˆçš„ç¼©å†™ï¼Ÿ", options: ["A. Hyper Text Markup Language", "B. High Tech Modern Language", "C. Home Tool Markup Language", "D. Hyperlinks and Text Markup Language"], answer: "A", explanation: "HTML æ˜¯Hyper Text Markup Languageï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºåˆ›å»ºç½‘é¡µçš„æ ‡å‡†æ ‡è®°è¯­è¨€ã€‚" },
                { question: "CSS ä¸­ç”¨äºè®¾ç½®æ–‡æœ¬é¢œè‰²çš„å±æ€§æ˜¯ï¼Ÿ", options: ["A. text-color", "B. font-color", "C. color", "D. text-style"], answer: "C", explanation: "åœ¨CSS ä¸­ï¼Œcolor å±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬çš„é¢œè‰²ã€‚text-color å’Œfont-color ä¸æ˜¯æœ‰æ•ˆçš„CSS å±æ€§ã€‚" },
                { question: "JavaScript ä¸­å£°æ˜å˜é‡çš„å…³é”®å­—ä¸åŒ…æ‹¬ï¼Ÿ", options: ["A. var", "B. let", "C. const", "D. define"], answer: "D", explanation: "JavaScriptä¸­å£°æ˜å˜é‡çš„å…³é”®å­—æœ‰varã€ letå’Œconstï¼Œdefine ä¸æ˜¯JavaScript ä¸­çš„å˜é‡å£°æ˜å…³é”®å­—ã€‚" }
            ],
            programming: [
                { question: "ä»¥ä¸‹å“ªä¸ªä¸æ˜¯JavaScript çš„æ•°æ®ç±»å‹ï¼Ÿ", options: ["A. Number", "B. String", "C. Float", "D. Boolean"], answer: "C", explanation: "JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬Numberã€ Stringã€Booleanã€Undefinedã€Nullã€Symbol å’ŒBigIntã€‚Float ä¸æ˜¯ç‹¬ç«‹çš„æ•°æ®ç±»å‹ï¼Œæ•°å­—éƒ½æ˜¯ Number ç±»å‹ã€‚" },
                { question: "Git ä¸­ï¼Œå“ªä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹æäº¤å†å²ï¼Ÿ", options: ["A. git status", "B. git log", "C. git history", "D. git commit"], answer: "B", explanation: "git log å‘½ä»¤ç”¨äºæŸ¥çœ‹æäº¤å†å²ã€‚git status æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€ï¼Œgit commit ç”¨äºæäº¤æ›´æ”¹ã€‚" },
                { question: "Python ä¸­ï¼Œä»¥ä¸‹å“ªä¸ªæ˜¯æ­£ç¡®çš„åˆ—è¡¨æ¨å¯¼å¼ï¼Ÿ", options: ["A. [x for x in range(10)]", "B. {x for x in range(10)}", "C. (x for x in range(10))", "D. x for x in range(10)"], answer: "A", explanation: "åˆ—è¡¨æ¨å¯¼å¼ä½¿ç”¨æ–¹æ‹¬å·[]ã€‚B æ˜¯é›†åˆæ¨å¯¼å¼ï¼ŒC æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ŒD è¯­æ³•é”™è¯¯ã€‚" },
                { question: "HTTP çŠ¶æ€ç 404 è¡¨ç¤ºä»€ä¹ˆï¼Ÿ", options: ["A. æœåŠ¡å™¨é”™è¯¯", "B. æœªæ‰¾åˆ°èµ„æº", "C. è¯·æ±‚æˆåŠŸ", "D. é‡å®šå‘"], answer: "B", explanation: "HTTP 404 çŠ¶æ€ç è¡¨ç¤ºNot Foundï¼Œå³è¯·æ±‚çš„èµ„æºæœªæ‰¾åˆ°ã€‚500 æ˜¯æœåŠ¡å™¨é”™è¯¯ï¼Œ200 æ˜¯æˆåŠŸï¼Œ3xx æ˜¯é‡å®šå‘ã€‚" },
                { question: "SQL ä¸­ï¼Œå“ªä¸ªå…³é”®å­—ç”¨äºå»é‡ï¼Ÿ", options: ["A. UNIQUE", "B. DISTINCT", "C. DIFFERENT", "D. SINGLE"], answer: "B", explanation: "DISTINCT å…³é”®å­—ç”¨äºè¿”å›å”¯ä¸€ä¸åŒçš„å€¼ã€‚UNIQUE æ˜¯çº¦æŸï¼Œä¸æ˜¯æŸ¥è¯¢å…³é”®å­—ã€‚" }
            ],
            science: [
                { question: "å…‰åœ¨çœŸç©ºä¸­çš„é€Ÿåº¦çº¦ä¸ºï¼Ÿ", options: ["A. 30 ä¸‡ç±³/ç§’", "B. 30 ä¸‡åƒç±³/ç§’", "C. 300 ä¸‡åƒç±³/ç§’", "D. 3 ä¸‡åƒç±³/ç§’"], answer: "B", explanation: "å…‰åœ¨çœŸç©ºä¸­çš„é€Ÿåº¦çº¦ä¸º299,792,458 ç±³/ç§’ï¼Œçº¦ç­‰äº30 ä¸‡åƒç±³/ç§’ã€‚" },
                { question: "DNA çš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["A. Deoxyribonucleic Acid", "B. Ribonucleic Acid", "C. Amino Acid", "D. Adenosine Triphosphate"], answer: "A", explanation: "DNA æ˜¯Deoxyribonucleic Acidï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰çš„ç¼©å†™ã€‚B æ˜¯RNAï¼ŒC æ˜¯æ°¨åŸºé…¸ï¼ŒD æ˜¯ATPã€‚" },
                { question: "åœ°çƒçš„å¹´é¾„å¤§çº¦æ˜¯ï¼Ÿ", options: ["A. 45 äº¿å¹´", "B. 100 äº¿å¹´", "C. 10 äº¿å¹´", "D. 1 äº¿å¹´"], answer: "A", explanation: "ç§‘å­¦ç ”ç©¶è¡¨æ˜ï¼Œåœ°çƒçš„å¹´é¾„çº¦ä¸º45.4 äº¿å¹´ã€‚" },
                { question: "åŒ–å­¦å…ƒç´ å‘¨æœŸè¡¨ä¸­ï¼Œé‡‘çš„å…ƒç´ ç¬¦å·æ˜¯ï¼Ÿ", options: ["A. Go", "B. Gd", "C. Au", "D. Ag"], answer: "C", explanation: "é‡‘çš„å…ƒç´ ç¬¦å·æ˜¯Auï¼Œ æ¥è‡ªæ‹‰ä¸æ–‡Aurumã€‚Ag æ˜¯é“¶ï¼ŒGd æ˜¯é’†ï¼ŒGo ä¸æ˜¯å…ƒç´ ç¬¦å·ã€‚" }
            ]
        };

        // æŒä¹…åŒ–å­˜å‚¨é”®å
        const STORAGE_KEY = 'quiz_app_state_v1';

        let questions = [];
        let currentIndex = 0;
        let hasAnswered = false;
        let correctAnswers = 0;
        let totalAttempts = 0;
        let currentImportFormat = 'json';

        // éŸ³æ•ˆåˆ›å»ºå‡½æ•°
        function playSound(frequency, duration) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // æ’­æ”¾ç­”å¯¹éŸ³æ•ˆ
        function playCorrectSound() {
            playSound(523, 0.1); // C5
            setTimeout(() => playSound(659, 0.1), 100); // E5
            setTimeout(() => playSound(784, 0.2), 200); // G5
        }

        // æ’­æ”¾ç­”é”™éŸ³æ•ˆ
        function playIncorrectSound() {
            playSound(400, 0.2); // G4
            setTimeout(() => playSound(300, 0.3), 200); // D4
        }

        // --- æŒä¹…åŒ–åŠŸèƒ½å¼€å§‹ ---
        function saveState() {
            const state = {
                questions,
                currentIndex,
                correctAnswers,
                totalAttempts
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    questions = state.questions || [];
                    currentIndex = state.currentIndex || 0;
                    correctAnswers = state.correctAnswers || 0;
                    totalAttempts = state.totalAttempts || 0;
                    return true;
                } catch (e) {
                    console.error('Failed to load state:', e);
                    return false;
                }
            }
            return false;
        }

        function clearState() {
            localStorage.removeItem(STORAGE_KEY);
        }
        // --- æŒä¹…åŒ–åŠŸèƒ½ç»“æŸ ---

        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®éšæœºèƒŒæ™¯
            const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];
            document.body.style.background = randomGradient;

            if (loadState()) {
                if (questions.length > 0) {
                    renderQuestion();
                } else {
                    renderEmptyState();
                }
            } else {
                renderEmptyState();
            }
        }

        // æ¸²æŸ“ç©ºçŠ¶æ€
        function renderEmptyState() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“š</div>
                    <div class="empty-title">è¿˜æ²¡æœ‰é¢˜ç›®æ•°æ®</div>
                    <div class="empty-text">
                        æ‚¨å¯ä»¥ä½¿ç”¨AI ç”Ÿæˆé¢˜ç›®æ•°æ®ï¼Œæˆ–ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®å¯¼å…¥é¢˜ç›®ã€‚<br>
                        é¢˜ç›®æ ¼å¼ä¸ºJavaScript æ•°ç»„æˆ–JSON æ ¼å¼ï¼Œ æœ€å¤šæ”¯æŒ30 é“é¢˜ã€‚
                    </div>
                    <div class="template-box">
const questions = [
    {
        question: "é¢˜ç›®å†…å®¹",
        options: ["A. é€‰é¡¹1", "B. é€‰é¡¹2", "C. é€‰é¡¹3", "D. é€‰é¡¹4"],
        answer: "A",
        explanation: "è§£æå†…å®¹"
    },
    // ... æœ€å¤š30é¢˜
];
                    </div>
                    <button class="btn btn-primary" onclick="showTemplateModal()">
                        <span>ğŸ“</span> é€‰æ‹©æ¨¡æ¿
                    </button>
                </div>
            `;
        }

        // æ˜¾ç¤ºæ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†
        function showTemplateModal() {
            document.getElementById('templateModal').classList.add('active');
        }

        // å…³é—­æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†
        function closeTemplateModal() {
            document.getElementById('templateModal').classList.remove('active');
        }

        // åŠ è½½æ¨¡æ¿
        function loadTemplate(type) {
            questions = [...templates[type]];
            currentIndex = 0;
            correctAnswers = 0;
            totalAttempts = 0;
            // æ¸…ç†é¢˜ç›®ä¸­å¯èƒ½æ®‹ç•™çš„ä½œç­”çŠ¶æ€ï¼ˆå¦‚æœæ˜¯é‡æ–°åŠ è½½ï¼‰
            questions = questions.map(q => {
                delete q.userSelectedOption;
                delete q.isCorrect;
                return q;
            });
            
            renderQuestion();
            saveState(); // ä¿å­˜çŠ¶æ€
            closeTemplateModal();
            showToast(' å·²åŠ è½½' + (type === 'basic' ? 'åŸºç¡€' : type === 'programming' ? 'ç¼–ç¨‹' : 'ç§‘å­¦') + 'æ¨¡æ¿', 'success');
        }

        // å¤åˆ¶æ¨¡æ¿ä»£ç 
        function copyTemplate(type) {
            const templateCode = `const questions = ${JSON.stringify(templates[type], null, 2)};`;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(templateCode).then(() => {
                    showToast('æ¨¡æ¿ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = templateCode;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast('æ¨¡æ¿ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } catch (err) {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                }
                document.body.removeChild(textarea);
            }
        }

        // æ¸²æŸ“é¢˜ç›®
        function renderQuestion() {
            const mainContent = document.getElementById('mainContent');
            if (questions.length === 0) {
                renderEmptyState();
                return;
            }

            const q = questions[currentIndex];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å†å²ä½œç­”è®°å½•
            if (q.userSelectedOption !== undefined) {
                hasAnswered = true;
            } else {
                hasAnswered = false;
            }

            // æ„å»ºé€‰é¡¹HTMLï¼Œå¤„ç†å†å²çŠ¶æ€
            const optionsHtml = q.options.map((option, index) => {
                let className = '';
                let iconHtml = '';
                
                if (hasAnswered) {
                    className = 'disabled'; // å·²ä½œç­”ï¼Œå…¨éƒ¨ç¦ç”¨
                    
                    // å¦‚æœæ˜¯ç”¨æˆ·é€‰æ‹©çš„é€‰é¡¹
                    if (index === q.userSelectedOption) {
                        className += q.isCorrect ? ' correct' : ' incorrect';
                        iconHtml = '<span class="icon">' + (q.isCorrect ? 'âœ“' : 'âœ—') + '</span>';
                    } 
                    // å¦‚æœæ˜¯æ­£ç¡®ç­”æ¡ˆä¸”ç”¨æˆ·æ²¡é€‰å¯¹ï¼ˆé«˜äº®æ­£ç¡®ç­”æ¡ˆï¼‰
                    else if (option.split('.')[0] === q.answer && !q.isCorrect) {
                        className += ' correct';
                        iconHtml = '<span class="icon">âœ“</span>';
                    }
                }

                return `<li class="${className}" onclick="selectOption(${index})">${option}${iconHtml}</li>`;
            }).join('');

            // åé¦ˆå’Œè§£æçš„æ˜¾ç¤ºçŠ¶æ€
            const feedbackStyle = hasAnswered ? 'block' : 'none';
            const feedbackClass = hasAnswered ? (q.isCorrect ? 'correct' : 'incorrect') : '';
            const feedbackText = hasAnswered ? (q.isCorrect ? 'å›ç­”æ­£ç¡®ï¼ğŸ‰' : 'å›ç­”é”™è¯¯ï¼ğŸ›µ') : '';
            const explanationStyle = hasAnswered ? 'block' : 'none';

            mainContent.innerHTML = `
                <div class="progress"> é¢˜ç›® ${currentIndex + 1} / ${questions.length}</div>
                <div class="question">${q.question}</div>
                <ul class="options" id="options">
                    ${optionsHtml}
                </ul>
                <div class="feedback" id="feedback" style="display: ${feedbackStyle}" class="${feedbackClass}">
                    ${feedbackText}
                </div>
                <div class="explanation" id="explanation" style="display: ${explanationStyle}">
                    ${q.explanation}
                </div>
                <div class="buttons">
                    <button onclick="prevQuestion()" ${currentIndex === 0 ? 'disabled' : ''}>ä¸Šä¸€é¢˜</button>
                    <button onclick="nextQuestion()" ${currentIndex === questions.length - 1 ? 'disabled' : ''}>ä¸‹ä¸€é¢˜</button>
                </div>
            `;
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(index) {
            if (hasAnswered) return; // å¦‚æœå·²ç»ä½œç­”ï¼Œä¸å…è®¸å†æ¬¡ç‚¹å‡»
            
            hasAnswered = true;
            totalAttempts++;
            
            const q = questions[currentIndex];
            const selectedAnswer = q.options[index].split('.')[0];
            const isCorrect = selectedAnswer === q.answer;
            
            // è®°å½•å½“å‰é¢˜ç›®çš„ä½œç­”çŠ¶æ€åˆ°æ•°æ®å¯¹è±¡ä¸­
            q.userSelectedOption = index;
            q.isCorrect = isCorrect;

            if (isCorrect) {
                correctAnswers++;
                playCorrectSound(); // æ’­æ”¾ç­”å¯¹éŸ³æ•ˆ
            } else {
                playIncorrectSound(); // æ’­æ”¾ç­”é”™éŸ³æ•ˆ
            }

            // æ›´æ–°é€‰é¡¹æ ·å¼
            const options = document.querySelectorAll('.options li');
            options.forEach((option, i) => {
                option.classList.add('disabled');
                const optionAnswer = option.textContent.split('.')[0];
                if (i === index) {
                    option.classList.add(isCorrect ? 'correct' : 'incorrect');
                    option.innerHTML += '<span class="icon">' + (isCorrect ? 'âœ“' : 'âœ—') + '</span>';
                } else if (optionAnswer === q.answer) {
                    option.classList.add('correct');
                    option.innerHTML += '<span class="icon">âœ“</span>';
                }
            });

            // æ˜¾ç¤ºåé¦ˆ
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedback.textContent = isCorrect ? 'å›ç­”æ­£ç¡®ï¼ğŸ‰' : 'å›ç­”é”™è¯¯ï¼ğŸ›µ';

            // æ˜¾ç¤ºè§£æ
            document.getElementById('explanation').style.display = 'block';

            // ä¿å­˜çŠ¶æ€
            saveState();

            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é¢˜ç›®
            if (currentIndex === questions.length - 1) {
                setTimeout(() => {
                    showCompletionMessage();
                }, 2000);
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                renderQuestion();
                saveState(); // ä¿å­˜å½“å‰é¢˜ç›®ç´¢å¼•
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentIndex < questions.length - 1) {
                currentIndex++;
                renderQuestion();
                saveState(); // ä¿å­˜å½“å‰é¢˜ç›®ç´¢å¼•
            }
        }

        // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
        function showCompletionMessage() {
            const mainContent = document.getElementById('mainContent');
            const accuracy = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
            let message = '';
            if (accuracy >= 90) {
                message = 'å¤ªæ£’äº†ï¼ä½ æ˜¯ç­”é¢˜é«˜æ‰‹ï¼ğŸ†';
            } else if (accuracy >= 70) {
                message = 'å¾ˆä¸é”™ï¼ç»§ç»­åŠ æ²¹ï¼ğŸ’ª';
            } else if (accuracy >= 50) {
                message = 'è¿˜å¯ä»¥ï¼Œå†æ¥å†å‰ï¼ğŸ“š';
            } else {
                message = 'éœ€è¦å¤šåŠ ç»ƒä¹ å“¦ï¼ğŸ’¡';
            }

            mainContent.innerHTML = `
                <div class="completion-message">
                    <div class="completion-title">ğŸŠ${message}</div>
                    <div class="completion-text"> æ‚¨å·²ç»å®Œæˆäº†æ‰€æœ‰${questions.length}é“é¢˜ç›®</div>
                    <div class="completion-stats">
                        <div class="stat-item">
                            <div class="stat-value">${correctAnswers}</div>
                            <div class="stat-label">æ­£ç¡®ç­”æ¡ˆ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${accuracy}%</div>
                            <div class="stat-label">æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${questions.length}</div>
                            <div class="stat-label">æ€»é¢˜æ•°</div>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="btn" style="background: white; color: var(--primary-color);" onclick="location.reload()">
                            <span>ğŸ”„</span> é‡æ–°å¼€å§‹
                        </button>
                    </div>
                </div>
            `;
            // å®Œæˆåæ¸…é™¤ä¿å­˜çš„çŠ¶æ€ï¼Œä¸‹æ¬¡åˆ·æ–°è¿›å…¥åˆå§‹çŠ¶æ€ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥ä¿ç•™ï¼Œçœ‹éœ€æ±‚ï¼Œè¿™é‡Œé€‰æ‹©ä¸æ¸…é™¤ï¼Œæ–¹ä¾¿æŸ¥çœ‹æœ€åä¸€é¢˜ï¼‰
            // å¦‚æœæƒ³åˆ·æ–°åç›´æ¥å›åˆ°åˆå§‹ç•Œé¢ï¼Œè§£å¼€ä¸‹é¢è¿™è¡Œæ³¨é‡Šï¼š
            // clearState(); 
        }

        // æ‰“å¼€å¯¼å…¥æ¨¡æ€æ¡†
        function openImportModal() {
            document.getElementById('importModal').classList.add('active');
            document.getElementById('importData').value = '';
            currentImportFormat = 'json';
            updateFormatTabs();
        }

        // å…³é—­å¯¼å…¥æ¨¡æ€æ¡†
        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        // åˆ‡æ¢å¯¼å…¥æ ¼å¼
        function switchFormat(format) {
            currentImportFormat = format;
            updateFormatTabs();
            const textarea = document.getElementById('importData');
            if (format === 'json') {
                textarea.placeholder = 'ç²˜è´´JSONæ ¼å¼çš„é¢˜ç›®æ•°æ®...';
            } else {
                textarea.placeholder = 'ç²˜è´´JavaScriptæ ¼å¼çš„é¢˜ç›®æ•°æ®...';
            }
        }

        // æ›´æ–°æ ¼å¼æ ‡ç­¾é¡µ
        function updateFormatTabs() {
            document.querySelectorAll('.format-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // å¯¼å…¥æ•°æ®- ä¿®å¤ç‰ˆæœ¬
        function importData() {
            const importText = document.getElementById('importData').value.trim();
            if (!importText) {
                showToast('è¯·è¾“å…¥é¢˜ç›®æ•°æ®', 'error');
                return;
            }

            try {
                let data;
                // æ ¹æ®é€‰æ‹©çš„æ ¼å¼è§£ææ•°æ®
                if (currentImportFormat === 'json') {
                    // JSON æ ¼å¼è§£æ
                    data = JSON.parse(importText);
                } else {
                    // JavaScript æ ¼å¼è§£æ
                    let jsCode = importText.trim();
                    if (jsCode.startsWith('const questions =')) {
                        jsCode = jsCode.replace('const questions =', '');
                    } else if (jsCode.startsWith('var questions =')) {
                        jsCode = jsCode.replace('var questions =', '');
                    } else if (jsCode.startsWith('let questions =')) {
                        jsCode = jsCode.replace('let questions =', '');
                    }
                    if (jsCode.endsWith(';')) {
                        jsCode = jsCode.slice(0, -1);
                    }
                    data = eval('(' + jsCode + ')');
                }

                if (!Array.isArray(data) || data.length === 0) {
                    showToast('æ•°æ®æ ¼å¼é”™è¯¯ï¼šéœ€è¦éç©ºæ•°ç»„', 'error');
                    return;
                }

                if (data.length > 30) {
                    showToast('é¢˜ç›®æ•°é‡è¶…è¿‡30é¢˜ï¼Œå·²æˆªå–å‰30é¢˜', 'info');
                    data.splice(30);
                }

                // éªŒè¯æ•°æ®æ ¼å¼
                const validQuestions = data.filter(q => {
                    return q.question &&
                           Array.isArray(q.options) &&
                           q.options.length >= 2 &&
                           q.answer &&
                           q.explanation;
                });

                if (validQuestions.length === 0) {
                    showToast('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®', 'error');
                    return;
                }

                questions = validQuestions;
                currentIndex = 0;
                correctAnswers = 0;
                totalAttempts = 0;
                renderQuestion();
                saveState(); // å¯¼å…¥æˆåŠŸåä¿å­˜çŠ¶æ€
                closeImportModal();
                showToast(` æˆåŠŸå¯¼å…¥${validQuestions.length} é“é¢˜ç›®`, 'success');

            } catch (error) {
                console.error('Import error:', error);
                showToast('æ•°æ®è§£æå¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰å†…å®¹
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é¢˜ç›®å—ï¼Ÿ')) {
                clearState(); // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                questions = [];
                currentIndex = 0;
                correctAnswers = 0;
                totalAttempts = 0;
                renderEmptyState();
                showToast('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'info');
            }
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = { success: 'âœ…', error: 'âŒ', info: 'â„¹ï¸' }[type] || 'â„¹ï¸';
            toast.innerHTML = `
                <span style="font-size: 16px;">${icon}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
