<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…³é”®è¯è®°å¿†ç«™</title>
<style>
:root { --primary-color: #0ea5e9; --secondary-color: #06b6d4;
--text-primary: #0f172a; --text-secondary: #64748b; --bg-color: #f8fafc; --card-bg: #ffffff; --border-color: #e2e8f0; }
* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',
'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); min-height: 100vh; color: var(--text-primary); position: relative; overflow-x: hidden; }
body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom:
0; background: radial-gradient(circle at 20% 50%, rgba(14, 165, 233, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%); z-index: 0; }
.container { max-width: 100%; padding: 15px 10px; position: relative;
z-index: 1; }
header { text-align: center; color: white; margin-bottom: 20px;
animation: fadeInDown 0.8s ease; }
h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px;
text-shadow: 0 4px 6px rgba(0,0,0,0.3); background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.subtitle { font-size: 14px; opacity: 0.9; font-weight: 300; color:
#cbd5e1; }
.control-panel-btn { position: fixed; top: 20px; right: 20px; background:
var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; z-index: 1000; }
.control-panel-btn:hover { background: var(--secondary-color);
transform: scale(1.1); }
.control-panel { position: fixed; top: 70px; right: 20px; background:
rgba(30, 41, 59, 0.95); backdrop-filter: blur(10px); border-radius: 12px; padding: 15px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); z-index: 999; display: none; min-width: 280px; max-width: 320px; border: 1px solid rgba(255, 255, 255, 0.1); }
.control-panel.show { display: block; animation: slideIn 0.3s ease; }
.control-group { margin-bottom: 15px; } .control-group:last-child { margin-bottom: 0; } .control-label { color: #cbd5e1; font-size: 12px; font-weight: 500;
margin-bottom: 8px; display: block; }
.control-input { width: 100%; background: #334155; color: #e2e8f0;
border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 12px; border-radius: 6px; font-size: 12px; margin-bottom: 8px; }
.control-input:focus { outline: none; border-color:
var(--primary-color); }
.control-btn { background: var(--primary-color); color: white; border:
none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; transition: all 0.2s ease; margin-right: 6px; margin-bottom: 6px; }
.control-btn:hover { background: var(--secondary-color); } .control-btn.danger { background: #ef4444; } .control-btn.danger:hover { background: #dc2626; } .category-list { max-height: 200px; overflow-y: auto; margin-bottom:
10px; }
.category-item { background: #334155; color: #e2e8f0; padding: 8px
12px; border-radius: 6px; margin-bottom: 6px; font-size: 11px; display: flex; justify-content: space-between; align-items: center; }
.category-item:hover { background: #475569; } .category-section { margin-bottom: 25px; } .category-title { color: white; font-size: 18px; font-weight: 600;
margin-bottom: 8px; padding-left: 5px; border-left: 3px solid var(--primary-color); }
.keywords-grid { display: grid; grid-template-columns: repeat(auto-fill,
minmax(80px, 1fr)); gap: 6px; }
.keyword-card { background: rgba(255, 255, 255, 0.95); backdrop-filter:
blur(10px); border-radius: 6px; padding: 6px; box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1); animation: fadeInUp 0.6s ease; transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.2); }
.keyword-card::before { content: ''; position: absolute; top: 0; left: 0;
right: 0; height: 2px; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); }
.keyword-card:hover { transform: translateY(-2px) scale(1.02);
box-shadow: 0 4px 8px -2px rgba(0, 0, 0, 0.15); }
.keyword-text { font-size: 11px; font-weight: 500; color:
var(--text-primary); text-align: center; word-break: break-all; line-height: 1.2; }
.keyword-tag { font-size: 9px; color: var(--text-secondary); text-align:
center; margin-top: 2px; }
.pagination { display: flex; justify-content: center; gap: 8px; margin-top:
30px; margin-bottom: 20px; }
.page-btn { background: rgba(255, 255, 255, 0.1); color: white; border:
1px solid rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s ease; }
.page-btn:hover { background: rgba(255, 255, 255, 0.2); } .page-btn.active { background: var(--primary-color); border-color:
var(--primary-color); }
.toast { position: fixed; bottom: 20px; left: 50%; transform:
translateX(-50%); background: var(--primary-color); color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px; z-index: 10000; opacity: 0; transition: opacity 0.3s ease; }
.toast.show { opacity: 1; } .toast.error { background: #ef4444; } .db-tip { position: fixed; bottom: 5px; right: 10px; color: rgba(0, 255, 0,
0.15); font-size: 8px; z-index: 10000; pointer-events: none; transition: opacity 0.5s; }
.stats { color: rgba(255, 255, 255, 0.7); text-align: center; font-size:
12px; margin-top: 10px; }
@keyframes fadeInDown { from { opacity: 0; transform:
translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform:
translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideIn { from { opacity: 0; transform: translateX(20px); }
to { opacity: 1; transform: translateX(0); } }
@media (min-width: 768px) { .container { max-width: 768px; margin:
0 auto; } .keywords-grid { grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px; } }
</style>
</head>
<body>
<div class="container">
<header>
<h1>ğŸ§ å…³é”®è¯è®°å¿†ç«™</h1>
<p class="subtitle">è®°å½•ä½ çš„æŠ€æœ¯å…³é”®è¯ï¼Œéšæ—¶æŸ¥é˜…</p>
</header>
<main id="keywordsContainer">
<!-- åŠ¨æ€ç”Ÿæˆçš„å…³é”®è¯å¡ç‰‡-->
</main>
<div class="pagination" id="pagination">
<!-- åŠ¨æ€ç”Ÿæˆçš„åˆ†é¡µæŒ‰é’®-->
</div>
<div class="stats" id="stats">
<!-- ç»Ÿè®¡ä¿¡æ¯-->
</div>
</div>
<!-- æ§åˆ¶é¢æ¿æŒ‰é’®-->
<button class="control-panel-btn" onclick="toggleControlPanel()">âš™ï¸</button>
<!-- æ§åˆ¶é¢æ¿-->
<div class="control-panel" id="controlPanel">
<div class="control-group">
<span class="control-label">æ·»åŠ æ–°åˆ†ç±»</span>
<input type="text" class="control-input" id="newCategoryInput" placeholder="è¾“å…¥åˆ†ç±»åç§°">
<button class="control-btn" onclick="addCategory()">æ·»åŠ åˆ†ç±»</button>
</div>
<div class="control-group">
<span class="control-label">æ·»åŠ å…³é”®è¯</span>
<select class="control-input" id="categorySelect">
<option value="">é€‰æ‹©åˆ†ç±»</option>
</select>
<input type="text" class="control-input" id="newKeywordInput" placeholder="è¾“å…¥å…³é”®è¯">
<button class="control-btn" onclick="addKeyword()">æ·»åŠ å…³é”®è¯</button>
</div>
<div class="control-group">
<span class="control-label">åˆ†ç±»ç®¡ç†</span>
<div class="category-list" id="categoryList">
<!-- åŠ¨æ€ç”Ÿæˆçš„åˆ†ç±»åˆ—è¡¨-->
</div>
</div>
</div>
<!-- Toast æç¤º-->
<div class="toast" id="toast"></div>
<!-- æ•°æ®åº“åŠ è½½æç¤º-->
<div class="db-tip" id="dbTip"></div>
<!-- æ•°æ®åº“å…¬å…±åº“-->
<script src="/db.js"></script>
<!-- é¡µé¢é€»è¾‘-->
<script>
// è°ƒè¯•é…ç½®
const DEBUG = true;
// åˆ†é¡µé…ç½®
let currentPage = 1;
const categoriesPerPage = 3; // æ¯é¡µæ˜¾ç¤º3ä¸ªåˆ†ç±»
let allCategories = [];
let systemKeywordsConfig = {}; // ç³»ç»Ÿå…³é”®è¯é…ç½®
let userKeywordsConfig = {}; // ç”¨æˆ·å…³é”®è¯é…ç½®
let keywordsConfig = {}; // åˆå¹¶åçš„å…³é”®è¯é…ç½®

// è°ƒè¯•å‡½æ•°
function debugLog(message, type = 'info') {
    if (!DEBUG) return;
    console.log(`[${type.toUpperCase()}] ${message}`);
}

// æ˜¾ç¤ºToastæç¤º
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast show';
    if (type === 'error') {
        toast.classList.add('error');
    }
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// æ˜¾ç¤ºæ•°æ®åº“åŠ è½½æç¤º
function showDbTip(message) {
    const tip = document.getElementById('dbTip');
    tip.textContent = message;
    tip.style.opacity = '1';
    setTimeout(() => {
        tip.style.opacity = '0';
    }, 2000);
}

// åˆ‡æ¢æ§åˆ¶é¢æ¿
function toggleControlPanel() {
    const panel = document.getElementById('controlPanel');
    panel.classList.toggle('show');
    if (panel.classList.contains('show')) {
        updateCategorySelect();
        updateCategoryList();
    }
}

// æ·»åŠ åˆ†ç±»
function addCategory() {
    const input = document.getElementById('newCategoryInput');
    const categoryName = input.value.trim();
    
    if (!categoryName) {
        showToast('è¯·è¾“å…¥åˆ†ç±»åç§°', 'error');
        return;
    }
    
    if (userKeywordsConfig[categoryName]) {
        showToast('åˆ†ç±»å·²å­˜åœ¨', 'error');
        return;
    }
    
    userKeywordsConfig[categoryName] = [];
    mergeConfigs();
    saveToDatabase();
    input.value = '';
    updateCategorySelect();
    updateCategoryList();
    renderKeywords();
    showToast(`åˆ†ç±»"${categoryName}" å·²æ·»åŠ `);
}

// æ·»åŠ å…³é”®è¯
function addKeyword() {
    const categorySelect = document.getElementById('categorySelect');
    const keywordInput = document.getElementById('newKeywordInput');
    const category = categorySelect.value;
    const keyword = keywordInput.value.trim();
    
    if (!category) {
        showToast('è¯·é€‰æ‹©åˆ†ç±»', 'error');
        return;
    }
    
    if (!keyword) {
        showToast('è¯·è¾“å…¥å…³é”®è¯', 'error');
        return;
    }
    
    // ç¡®å®šå…³é”®è¯åº”è¯¥æ·»åŠ åˆ°å“ªä¸ªé…ç½®ä¸­
    let targetConfig = userKeywordsConfig;
    
    // å¦‚æœåˆ†ç±»åœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œåˆ™æ·»åŠ åˆ°ç”¨æˆ·é…ç½®ä¸­ï¼ˆåˆ›å»ºä¸€ä¸ªåŒåçš„ç”¨æˆ·åˆ†ç±»ï¼‰
    if (systemKeywordsConfig[category] && !userKeywordsConfig[category]) {
        userKeywordsConfig[category] = [];
    }
    
    if (userKeywordsConfig[category].includes(keyword)) {
        showToast('å…³é”®è¯å·²å­˜åœ¨', 'error');
        return;
    }
    
    userKeywordsConfig[category].push(keyword);
    mergeConfigs();
    saveToDatabase();
    keywordInput.value = '';
    renderKeywords();
    showToast(`å…³é”®è¯"${keyword}" å·²æ·»åŠ åˆ°"${category}"`);
}

// åˆ é™¤åˆ†ç±»
function deleteCategory(category) {
    if (confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${category}"å—ï¼Ÿ`)) {
        // åªèƒ½åˆ é™¤ç”¨æˆ·åˆ›å»ºçš„åˆ†ç±»ï¼Œä¸èƒ½åˆ é™¤ç³»ç»Ÿåˆ†ç±»
        if (systemKeywordsConfig[category]) {
            showToast('ä¸èƒ½åˆ é™¤ç³»ç»Ÿåˆ†ç±»', 'error');
            return;
        }
        
        delete userKeywordsConfig[category];
        mergeConfigs();
        saveToDatabase();
        updateCategorySelect();
        updateCategoryList();
        renderKeywords();
        showToast(`åˆ†ç±»"${category}" å·²åˆ é™¤`);
    }
}

// åˆ é™¤å…³é”®è¯
function deleteKeyword(category, keyword) {
    if (confirm(`ç¡®å®šè¦åˆ é™¤å…³é”®è¯"${keyword}"å—ï¼Ÿ`)) {
        // ç¡®å®šå…³é”®è¯åœ¨å“ªä¸ªé…ç½®ä¸­
        let targetConfig = userKeywordsConfig;
        
        // å¦‚æœåˆ†ç±»åœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œä¸”å…³é”®è¯ä¹Ÿåœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œåˆ™ä¸èƒ½åˆ é™¤
        if (systemKeywordsConfig[category] && systemKeywordsConfig[category].includes(keyword)) {
            // å¦‚æœç”¨æˆ·é…ç½®ä¸­ä¹Ÿæœ‰è¿™ä¸ªå…³é”®è¯ï¼Œåˆ™åªåˆ é™¤ç”¨æˆ·é…ç½®ä¸­çš„
            if (userKeywordsConfig[category] && userKeywordsConfig[category].includes(keyword)) {
                const index = userKeywordsConfig[category].indexOf(keyword);
                if (index > -1) {
                    userKeywordsConfig[category].splice(index, 1);
                }
            } else {
                showToast('ä¸èƒ½åˆ é™¤ç³»ç»Ÿå…³é”®è¯', 'error');
                return;
            }
        } else {
            // åˆ é™¤ç”¨æˆ·é…ç½®ä¸­çš„å…³é”®è¯
            const index = userKeywordsConfig[category].indexOf(keyword);
            if (index > -1) {
                userKeywordsConfig[category].splice(index, 1);
            }
        }
        
        mergeConfigs();
        saveToDatabase();
        renderKeywords();
        showToast(`å…³é”®è¯"${keyword}" å·²åˆ é™¤`);
    }
}

// æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
function updateCategorySelect() {
    const select = document.getElementById('categorySelect');
    select.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>';
    
    // æ·»åŠ æ‰€æœ‰åˆ†ç±»ï¼ˆç³»ç»Ÿ+ç”¨æˆ·ï¼‰
    Object.keys(keywordsConfig).forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        select.appendChild(option);
    });
}

// æ›´æ–°åˆ†ç±»åˆ—è¡¨
function updateCategoryList() {
    const list = document.getElementById('categoryList');
    list.innerHTML = '';
    
    // æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»ï¼Œä½†æ ‡è®°ç³»ç»Ÿåˆ†ç±»å’Œç”¨æˆ·åˆ†ç±»
    Object.entries(keywordsConfig).forEach(([category, keywords]) => {
        const item = document.createElement('div');
        item.className = 'category-item';
        
        const isSystemCategory = systemKeywordsConfig[category] ? true : false;
        const categoryLabel = isSystemCategory ? `${category} (ç³»ç»Ÿ)` : `${category} (ç”¨æˆ·)`;
        
        item.innerHTML = `
            <span>${categoryLabel} (${keywords.length})</span>
            ${!isSystemCategory ? `<button class="control-btn danger" onclick="deleteCategory('${category}')">åˆ é™¤</button>` : ''}
        `;
        list.appendChild(item);
    });
}

// åˆå¹¶ç³»ç»Ÿé…ç½®å’Œç”¨æˆ·é…ç½®
function mergeConfigs() {
    keywordsConfig = {};
    
    // é¦–å…ˆæ·»åŠ ç³»ç»Ÿé…ç½®
    Object.keys(systemKeywordsConfig).forEach(category => {
        keywordsConfig[category] = [...systemKeywordsConfig[category]];
    });
    
    // ç„¶åæ·»åŠ ç”¨æˆ·é…ç½®ï¼Œå¦‚æœæœ‰åŒåçš„åˆ†ç±»ï¼Œåˆ™åˆå¹¶å…³é”®è¯
    Object.keys(userKeywordsConfig).forEach(category => {
        if (keywordsConfig[category]) {
            // åˆå¹¶å…³é”®è¯ï¼Œé¿å…é‡å¤
            userKeywordsConfig[category].forEach(keyword => {
                if (!keywordsConfig[category].includes(keyword)) {
                    keywordsConfig[category].push(keyword);
                }
            });
        } else {
            keywordsConfig[category] = [...userKeywordsConfig[category]];
        }
    });
}

// ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æ•°æ®åº“ - ä¿®æ”¹ä¸ºç›´æ¥å­˜å‚¨JSON
async function saveToDatabase() {
    try {
        // ç›´æ¥å­˜å‚¨JSONå¯¹è±¡åˆ°ç”¨æˆ·å­˜å‚¨åŒºï¼Œä¸å†åŒ…è£…ä¸ºJavaScriptä»£ç 
        await IDB.put('user_keywords_config', userKeywordsConfig, 'userdata');
        debugLog('ç”¨æˆ·é…ç½®å·²ä¿å­˜åˆ°æ•°æ®åº“', 'success');
    } catch (error) {
        debugLog(`ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
    }
}

// å¤åˆ¶å…³é”®è¯åˆ°å‰ªè´´æ¿
function copyKeyword(keyword) {
    navigator.clipboard.writeText(keyword).then(() => {
        showToast(`å·²å¤åˆ¶: ${keyword}`);
        debugLog(`å…³é”®è¯å·²å¤åˆ¶: ${keyword}`, 'success');
    }).catch(() => {
        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        debugLog('å…³é”®è¯å¤åˆ¶å¤±è´¥', 'error');
    });
}

// æ¸²æŸ“å…³é”®è¯å¡ç‰‡
function renderKeywords() {
    debugLog('å¼€å§‹æ¸²æŸ“å…³é”®è¯å¡ç‰‡', 'info');
    const container = document.getElementById('keywordsContainer');
    const pagination = document.getElementById('pagination');
    const stats = document.getElementById('stats');
    
    allCategories = Object.keys(keywordsConfig);
    
    // è®¡ç®—å½“å‰é¡µçš„åˆ†ç±»
    const startIndex = (currentPage - 1) * categoriesPerPage;
    const endIndex = startIndex + categoriesPerPage;
    const currentCategories = allCategories.slice(startIndex, endIndex);
    
    container.innerHTML = '';
    
    // æŒ‰åˆ†ç±»æ¸²æŸ“
    currentCategories.forEach((category, index) => {
        const section = document.createElement('div');
        section.className = 'category-section';
        
        const title = document.createElement('h2');
        title.className = 'category-title';
        
        // æ ‡è®°ç³»ç»Ÿåˆ†ç±»å’Œç”¨æˆ·åˆ†ç±»
        const isSystemCategory = systemKeywordsConfig[category] ? true : false;
        title.textContent = isSystemCategory ? `${category} (ç³»ç»Ÿ)` : `${category} (ç”¨æˆ·)`;
        
        section.appendChild(title);
        
        const grid = document.createElement('div');
        grid.className = 'keywords-grid';
        
        const keywords = keywordsConfig[category] || [];
        keywords.forEach((keyword, keywordIndex) => {
            const card = document.createElement('div');
            card.className = 'keyword-card';
            card.style.animationDelay = `${(index * keywords.length + keywordIndex) * 0.02}s`;
            
            // æ ‡è®°ç³»ç»Ÿå…³é”®è¯å’Œç”¨æˆ·å…³é”®è¯
            const isSystemKeyword = systemKeywordsConfig[category] && 
                                   systemKeywordsConfig[category].includes(keyword);
            const keywordTag = isSystemKeyword ? 'ç³»ç»Ÿå…³é”®è¯' : 'ç”¨æˆ·å…³é”®è¯';
            
            card.innerHTML = `
                <div class="keyword-text">${keyword}</div>
                <div class="keyword-tag">${keywordTag}</div>
            `;
            
            card.onclick = () => copyKeyword(keyword);
            grid.appendChild(card);
        });
        
        section.appendChild(grid);
        container.appendChild(section);
    });
    
    // æ¸²æŸ“åˆ†é¡µ
    const totalPages = Math.ceil(allCategories.length / categoriesPerPage);
    pagination.innerHTML = '';
    
    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.className = 'page-btn';
        if (i === currentPage) btn.classList.add('active');
        btn.textContent = i;
        btn.onclick = () => {
            currentPage = i;
            renderKeywords();
        };
        pagination.appendChild(btn);
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    const totalKeywords = Object.values(keywordsConfig).reduce((sum, keywords) => sum + keywords.length, 0);
    const systemKeywordsCount = Object.values(systemKeywordsConfig).reduce((sum, keywords) => sum + keywords.length, 0);
    const userKeywordsCount = Object.values(userKeywordsConfig).reduce((sum, keywords) => sum + keywords.length, 0);
    
    stats.textContent = `ç¬¬ ${currentPage}/${totalPages} é¡µ | å…± ${allCategories.length} ä¸ªåˆ†ç±» | ${totalKeywords} ä¸ªå…³é”®è¯ (ç³»ç»Ÿ: ${systemKeywordsCount}, ç”¨æˆ·: ${userKeywordsCount})`;
    
    debugLog(`å…³é”®è¯å¡ç‰‡æ¸²æŸ“å®Œæˆï¼Œå½“å‰é¡µ: ${currentPage}/${totalPages}`, 'success');
}

// åŠ è½½ç³»ç»Ÿå…³é”®è¯é…ç½®ï¼ˆå¸¦ç¼“å­˜ï¼‰
async function loadSystemKeywordsConfig() {
    const configFileName = '5_å…³é”®è¯é…ç½®.js';
    
    try {
        // â‘ ä¼˜å…ˆä»ç³»ç»Ÿå­˜å‚¨åŒºè¯»å–
        const cachedConfig = await IDB.get(configFileName, 'official');
        if (cachedConfig) {
            debugLog('ç³»ç»Ÿå­˜å‚¨åŒºå‘½ä¸­é…ç½®æ–‡ä»¶', 'success');
            showDbTip('âš¡ä»ç³»ç»Ÿå­˜å‚¨åŒºåŠ è½½');
            return cachedConfig;
        }
        
        debugLog('ç³»ç»Ÿå­˜å‚¨åŒºæœªå‘½ä¸­ï¼Œå¼€å§‹ç½‘ç»œè¯·æ±‚', 'info');
        showDbTip('ğŸŒé¦–æ¬¡æ‹‰å–');
        
        // â‘¡ç³»ç»Ÿå­˜å‚¨åŒºæ²¡æœ‰æ‰fetch
        const resp = await fetch(configFileName);
        if (!resp.ok) {
            throw new Error(`é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥: ${configFileName} (çŠ¶æ€: ${resp.status})`);
        }
        
        const text = await resp.text();
        debugLog(`é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸï¼Œå¤§å°: ${text.length} å­—ç¬¦`, 'success');
        
        // â‘¢ç«‹å³å†™åº“åˆ°ç³»ç»Ÿå­˜å‚¨åŒº
        await IDB.put(configFileName, text, 'official');
        debugLog('é…ç½®æ–‡ä»¶å·²ç¼“å­˜åˆ°ç³»ç»Ÿå­˜å‚¨åŒº', 'success');
        
        return text;
    } catch (error) {
        debugLog(`é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥: ${error.message}`, 'error');
        throw error;
    }
}

// åŠ è½½ç”¨æˆ·å…³é”®è¯é…ç½® - ä¿®æ”¹ä¸ºç›´æ¥è¯»å–JSON
async function loadUserKeywordsConfig() {
    try {
        // ä»ç”¨æˆ·å­˜å‚¨åŒºè¯»å–ç”¨æˆ·é…ç½®ï¼ˆç›´æ¥JSONå¯¹è±¡ï¼‰
        const cachedConfig = await IDB.get('user_keywords_config', 'userdata');
        if (cachedConfig) {
            debugLog('ç”¨æˆ·å­˜å‚¨åŒºå‘½ä¸­ç”¨æˆ·é…ç½®', 'success');
            showDbTip('âš¡ä»ç”¨æˆ·å­˜å‚¨åŒºåŠ è½½');
            return cachedConfig;
        }
        
        debugLog('ç”¨æˆ·å­˜å‚¨åŒºæœªå‘½ä¸­ï¼Œä½¿ç”¨ç©ºé…ç½®', 'info');
        showDbTip('ğŸ“ä½¿ç”¨ç©ºé…ç½®');
        return {};
    } catch (error) {
        debugLog(`ç”¨æˆ·é…ç½®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
        return {};
    }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', async () => {
    debugLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–', 'info');
    
    try {
        // ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–
        debugLog('åˆå§‹åŒ–æ•°æ®åº“', 'info');
        await IDB.init();
        debugLog('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ', 'success');
        
        // åŠ è½½ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼ˆå¸¦ç¼“å­˜ï¼‰
        const systemConfigText = await loadSystemKeywordsConfig();
        
        // æ‰§è¡Œç³»ç»Ÿé…ç½®ä»£ç 
        eval(systemConfigText);
        
        // æ£€æŸ¥ç³»ç»Ÿé…ç½®æ˜¯å¦åŠ è½½æˆåŠŸ
        if (!window.KEYWORDS_CONFIG) {
            throw new Error('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œæœªæ‰¾åˆ°KEYWORDS_CONFIG');
        }
        
        systemKeywordsConfig = window.KEYWORDS_CONFIG;
        
        // åŠ è½½ç”¨æˆ·é…ç½®ï¼ˆç›´æ¥JSONå¯¹è±¡ï¼‰
        userKeywordsConfig = await loadUserKeywordsConfig();
        
        // åˆå¹¶ç³»ç»Ÿé…ç½®å’Œç”¨æˆ·é…ç½®
        mergeConfigs();
        
        allCategories = Object.keys(keywordsConfig);
        
        // æ¸²æŸ“å…³é”®è¯
        renderKeywords();
        
        showToast('å…³é”®è¯è®°å¿†ç«™å·²åŠ è½½ï¼');
        debugLog('å…³é”®è¯è®°å¿†ç«™åˆå§‹åŒ–å®Œæˆ', 'success');
    } catch (error) {
        debugLog(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
        console.error('åˆå§‹åŒ–å¤±è´¥:', error);
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        const container = document.getElementById('keywordsContainer');
        container.innerHTML = `
            <div style="color: #f87171; text-align: center; padding: 40px;">
                <h3>åŠ è½½å¤±è´¥</h3>
                <p>${error.message}</p>
            </div>
        `;
        showToast('åˆå§‹åŒ–å¤±è´¥', 'error');
    }
});

// ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­æ§åˆ¶é¢æ¿
document.addEventListener('click', (e) => {
    const panel = document.getElementById('controlPanel');
    const btn = document.querySelector('.control-panel-btn');
    if (!panel.contains(e.target) && !btn.contains(e.target)) {
        panel.classList.remove('show');
    }
});
</script>
</body>
</html>
