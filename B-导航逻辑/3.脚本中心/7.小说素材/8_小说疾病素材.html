<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸¸è§ç–¾ç—…æŸ¥è¯¢ç³»ç»Ÿ</title>
    
     <!-- å¼•å…¥æ•°æ®åº“ç®¡ç†å™¨ -->
    <script src="/db.js"></script>
    <script src="8_å°è¯´ç–¾ç—…ç´ æ.js"></script>
    <!-- å¼•å…¥ç¼©æ”¾æ’ä»¶ -->
  <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶å·¥å…·/3.æ’ä»¶_å­—ä½“ç¼©æ”¾.js"></script>
  
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            line-height: 1.4;
            font-size: 0.85rem;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            padding: 8px;
        }
        .header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 3px;
        }
        .search-box {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            gap: 8px;
        }
        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .search-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .category {
            background: white;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .category-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .category-icon {
            width: 22px;
            height: 22px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        .disease-list {
            padding: 4px;
        }
        .disease-item {
            display: flex;
            padding: 6px 8px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        .disease-item:last-child {
            border-bottom: none;
        }
        .disease-item:hover {
            background: #f8f9fa;
        }
        .disease-name {
            flex: 0 0 110px;
            font-weight: 500;
            color: #333;
            font-size: 0.8rem;
            padding-right: 8px;
        }
        .disease-content {
            flex: 1;
            color: #555;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
        }
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        .pagination button:hover:not(:disabled) {
            background: #f0f0f0;
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        .pagination-info {
            font-size: 0.8rem;
            color: #666;
            margin: 0 10px;
        }
        .stats {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 10px;
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ å¸¸è§ç–¾ç—…æŸ¥è¯¢ç³»ç»Ÿ</h1>
        </div>
        
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="è¾“å…¥ç–¾ç—…åç§°æœç´¢...">
            <button class="search-btn" onclick="searchDiseases()">æœç´¢</button>
        </div>
        
        <div class="stats" id="statsContainer">
            æ­£åœ¨åŠ è½½æ•°æ®...
        </div>
        
        <div id="contentContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                æ­£åœ¨åŠ è½½æ•°æ®...
            </div>
        </div>
        
        <div class="pagination" id="pagination" style="display: none;">
            <button onclick="goToPage('prev')" id="prevBtn">ä¸Šä¸€é¡µ</button>
            <div id="pageNumbers"></div>
            <button onclick="goToPage('next')" id="nextBtn">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

    <script>
        let allDiseaseData = null;
        let filteredData = null;
        let currentPage = 1;
        const itemsPerPage = 2; // æ¯é¡µæ˜¾ç¤º2ä¸ªåˆ†ç±»
        
        // ç¼“å­˜é…ç½®æ–‡ä»¶å¹¶æ¸²æŸ“æ•°æ®
        async function loadDiseaseData() {
            try {
                // ä½¿ç”¨IDB.CacheMgrè·å–é…ç½®æ–‡ä»¶ï¼ˆä¼˜å…ˆä»ç¼“å­˜ï¼‰
                const configText = await IDB.CacheMgr.get('8_å°è¯´ç–¾ç—…ç´ æ.js');
                
                // æ‰§è¡Œé…ç½®æ–‡ä»¶å†…å®¹
                eval(configText);
                allDiseaseData = diseaseData;
                filteredData = diseaseData;
                
                // æ¸²æŸ“é¡µé¢
                renderPage(currentPage);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStats(filteredData);
                
                // ä¿å­˜æµè§ˆå†å²åˆ°ç”¨æˆ·åŒºåŸŸï¼ˆä½¿ç”¨E_å‰ç¼€ï¼‰
                saveViewHistory('diseases_home');
                
            } catch (error) {
                console.error('åŠ è½½ç–¾ç—…æ•°æ®å¤±è´¥:', error);
                document.getElementById('contentContainer').innerHTML = `
                    <div class="loading" style="flex-direction: column; gap: 15px;">
                        <div style="color: #ff6b6b; font-size: 1.1rem;">âš ï¸ æ•°æ®åŠ è½½å¤±è´¥</div>
                        <div style="font-size: 0.9rem;">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</div>
                        <button onclick="location.reload()" style="
                            padding: 8px 16px; 
                            background: rgba(255,255,255,0.2); 
                            border: 1px solid white; 
                            color: white; 
                            border-radius: 20px; 
                            cursor: pointer; 
                            margin-top: 10px; 
                            font-size: 0.8rem;
                        ">é‡æ–°åŠ è½½</button>
                    </div>`;
            }
        }
        
        // æ¸²æŸ“é¡µé¢
        function renderPage(page) {
            if (!filteredData) return;
            
            const container = document.getElementById('contentContainer');
            container.innerHTML = '';
            
            // è®¡ç®—åˆ†é¡µèŒƒå›´
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const categoriesToShow = filteredData.categories.slice(startIndex, endIndex);
            
            // éå†åˆ†ç±»
            categoriesToShow.forEach((category, index) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜ï¼ˆä½¿ç”¨ä¸­æ–‡æ•°å­—ï¼‰
                const header = document.createElement('div');
                header.className = 'category-header';
                const chineseNumbers = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å'];
                header.innerHTML = `
                    <div class="category-icon">${chineseNumbers[startIndex + index]}</div>
                    <span>${category.title}</span>
                `;
                
                // åˆ›å»ºç–¾ç—…åˆ—è¡¨
                const diseaseList = document.createElement('div');
                diseaseList.className = 'disease-list';
                
                // éå†åˆ†ç±»ä¸‹çš„æ‰€æœ‰ç–¾ç—…
                category.items.forEach((disease, diseaseIndex) => {
                    const diseaseItem = document.createElement('div');
                    diseaseItem.className = 'disease-item';
                    diseaseItem.innerHTML = `
                        <div class="disease-name">${diseaseIndex + 1}. ${disease.name}</div>
                        <div class="disease-content">${disease.content}</div>
                    `;
                    diseaseList.appendChild(diseaseItem);
                });
                
                categoryDiv.appendChild(header);
                categoryDiv.appendChild(diseaseList);
                container.appendChild(categoryDiv);
            });
            
            // æ›´æ–°åˆ†é¡µæ§ä»¶
            updatePagination();
        }
        
        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            if (!filteredData) return;
            
            const totalPages = Math.ceil(filteredData.categories.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            const pageNumbers = document.getElementById('pageNumbers');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // æ˜¾ç¤ºåˆ†é¡µæ§ä»¶
            pagination.style.display = 'flex';
            
            // æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            // ç”Ÿæˆé¡µç æŒ‰é’®
            pageNumbers.innerHTML = '';
            const maxPageButtons = 5; // æœ€å¤šæ˜¾ç¤º5ä¸ªé¡µç æŒ‰é’®
            
            let startPage = Math.max(1, currentPage - Math.floor(maxPageButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);
            
            if (endPage - startPage < maxPageButtons - 1) {
                startPage = Math.max(1, endPage - maxPageButtons + 1);
            }
            
            // æ·»åŠ ç¬¬ä¸€é¡µå’Œçœç•¥å·
            if (startPage > 1) {
                addPageButton(1);
                if (startPage > 2) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 5px';
                    pageNumbers.appendChild(dots);
                }
            }
            
            // æ·»åŠ é¡µç æŒ‰é’®
            for (let i = startPage; i <= endPage; i++) {
                addPageButton(i);
            }
            
            // æ·»åŠ çœç•¥å·å’Œæœ€åä¸€é¡µ
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 5px';
                    pageNumbers.appendChild(dots);
                }
                addPageButton(totalPages);
            }
            
            function addPageButton(pageNum) {
                const btn = document.createElement('button');
                btn.textContent = pageNum;
                btn.onclick = () => goToPage(pageNum);
                if (pageNum === currentPage) {
                    btn.classList.add('active');
                }
                pageNumbers.appendChild(btn);
            }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šé¡µé¢
        function goToPage(page) {
            if (!filteredData) return;
            
            const totalPages = Math.ceil(filteredData.categories.length / itemsPerPage);
            
            if (page === 'prev') {
                currentPage = Math.max(1, currentPage - 1);
            } else if (page === 'next') {
                currentPage = Math.min(totalPages, currentPage + 1);
            } else {
                currentPage = page;
            }
            
            renderPage(currentPage);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(data) {
            const totalDiseases = data.categories.reduce((sum, cat) => sum + cat.items.length, 0);
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                å…±æ”¶å½• <span class="highlight">${data.categories.length}</span> ä¸ªåˆ†ç±»ï¼Œ
                <span class="highlight">${totalDiseases}</span> ç§å¸¸è§ç–¾ç—…
            `;
        }
        
        // æœç´¢åŠŸèƒ½
        function searchDiseases() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) {
                filteredData = allDiseaseData;
                currentPage = 1;
                renderPage(currentPage);
                updateStats(filteredData);
                return;
            }
            
            filteredData = {
                categories: allDiseaseData.categories.map(category => ({
                    ...category,
                    items: category.items.filter(disease => 
                        disease.name.toLowerCase().includes(searchTerm) || 
                        disease.content.toLowerCase().includes(searchTerm)
                    )
                })).filter(category => category.items.length > 0)
            };
            
            currentPage = 1;
            renderPage(currentPage);
            updateStats(filteredData);
        }
        
        // ä¿å­˜æµè§ˆå†å²ï¼ˆä½¿ç”¨E_å‰ç¼€å­˜å‚¨åˆ°ç”¨æˆ·åŒºåŸŸï¼‰
        async function saveViewHistory(page) {
            try {
                const history = await IDB.get('E_viewHistory', 'userdata') || [];
                const now = new Date().toISOString();
                
                // æ·»åŠ æ–°çš„æµè§ˆè®°å½•
                history.unshift({
                    page: page,
                    timestamp: now
                });
                
                // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
                if (history.length > 20) {
                    history.splice(20);
                }
                
                await IDB.put('E_viewHistory', history, 'userdata');
            } catch (error) {
                console.error('ä¿å­˜æµè§ˆå†å²å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–æ•°æ®åº“
            IDB.init().then(() => {
                console.log('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ');
                // åŠ è½½é…ç½®æ–‡ä»¶
                loadDiseaseData();
            }).catch(error => {
                console.error('æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('contentContainer').innerHTML = `
                    <div class="loading" style="flex-direction: column; gap: 15px;">
                        <div style="color: #ff6b6b; font-size: 1.1rem;">âš ï¸ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥</div>
                        <div style="font-size: 0.9rem;">è¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒIndexedDB</div>
                    </div>`;
            });
        });
    </script>
</body>
</html>
