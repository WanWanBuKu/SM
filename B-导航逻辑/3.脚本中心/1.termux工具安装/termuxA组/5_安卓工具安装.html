<!DOCTYPE html> 
<html lang="zh"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>cordova é¡µé¢æ‰“åŒ…APP æŒ‡å—</title> 
  <!-- Prism.js ä»£ç é«˜äº®--> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme"> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script> 
 
</head> 
<body> 
  <div class="container" id="mainContainer"> 
    <div class="header"> 
      <h1>ğŸ“±cordovaå·¥å…·å®‰è£…</h1> 
      <p>é…ç½®cordovaç¯å¢ƒ</p> 
      <div class="progress-bar"> 
        <div class="progress-fill" id="progressBar"></div> 
      </div> 
    </div> 
    
    <!-- æ ‡ç­¾é¡µåˆ‡æ¢--> 
    <div class="tabs"> 
      <button class="tab active" onclick="switchTab('table')">ğŸ“‹ å·¥å…·åˆ—è¡¨</button> 
      <button class="tab" onclick="switchTab('modules')">ğŸ“¦ å®‰è£…æ¨¡å—</button> 
    </div> 
    
    <div id="contentContainer"> 
      <div class="loading"> 
        <div class="loading-spinner"></div> 
        æ­£åœ¨åŠ è½½é…ç½®æŒ‡å—... 
      </div> 
    </div> 
    
    <div class="tips"> 
      <h3>ğŸ’¡ä½¿ç”¨è¯´æ˜</h3> 
      <ul> 
        <li>ç¬¬ä¸€é¡µæŸ¥çœ‹æ‰€æœ‰å·¥å…·åˆ—è¡¨å’Œå®‰è£…æ–¹å¼</li> 
        <li>ç¬¬äºŒé¡µæŸ¥çœ‹æ¨¡å—åŒ–å®‰è£…è„šæœ¬</li> 
        <li>ç‚¹å‡»å‘½ä»¤å—å³ä¸Šè§’"å¤åˆ¶"æŒ‰é’®å¿«é€Ÿå¤åˆ¶</li> 
        <li>æ‰€æœ‰å‘½ä»¤éœ€åœ¨Termuxç¯å¢ƒä¸­æ‰§è¡Œ</li> 
        <li>ç‚¹å‡»æ¨¡å—å¯æ ‡è®°ä¸ºå·²å®Œæˆï¼Œè¿›åº¦è‡ªåŠ¨ä¿å­˜</li> 
        <li>ä½¿ç”¨å³ä¸‹è§’+/-æŒ‰é’®è°ƒæ•´é¡µé¢ç¼©æ”¾</li> 
        <li>1. å®‰è£…nodejsï¼Œéœ€è¦å…ˆå®‰è£…libicu - - - 2. å®‰è£…jdk-17ï¼Œå¸è½½jdk-21</li> 
      </ul> 
    </div> 
    
    <!-- ä¸»é¢˜åˆ‡æ¢å™¨--> 
    <div class="theme-switcher"> 
      <button class="theme-btn" onclick="switchTheme()">ğŸŒ™åˆ‡æ¢ä¸»é¢˜</button> 
    </div> 
  </div> 
  
  <!-- å¼•å…¥æ•°æ®åº“ç®¡ç†å™¨ -->
    <script src="/db.js"></script>
    <!-- å¼•å…¥å…¬å…±æ’ä»¶ -->
    <script src="common-plugin.js"></script>  
    <!-- å¼•å…¥ç¼©æ”¾æ’ä»¶ -->
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶å·¥å…·/3.æ’ä»¶_å­—ä½“ç¼©æ”¾-è®°å¿†.js"></script>
  
  <!-- å¼•å…¥é…ç½®æ–‡ä»¶--> 
  <script src="5_å®‰å“å·¥å…·å®‰è£….js"></script>
  <script src="5_é¡µé¢ç¾åŒ–åŒ….js"></script> 
  
  <script> 
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– 
    document.addEventListener('DOMContentLoaded', async () => { 
      try { 
        // åˆå§‹åŒ–æ•°æ®åº“ 
        await IDB.init(); 
        console.log('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ'); 
        
        // åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆä¼˜å…ˆä»ç¼“å­˜ï¼‰ 
        const configText = await IDB.CacheMgr.get('5_å®‰å“å·¥å…·å®‰è£….js'); 
        if (configText) { 
          eval(configText); 
          
          // é»˜è®¤æ˜¾ç¤ºè¡¨æ ¼é¡µ 
          renderTable(); 
          
          // ä¿å­˜æµè§ˆè®°å½• 
          CommonPlugin.saveViewHistory('android_tools'); 
          
          // åŠ è½½ä¸»é¢˜ 
          CommonPlugin.loadTheme(); 
        } 
      } catch (error) { 
        console.error('åŠ è½½å¤±è´¥:', error); 
        CommonPlugin.showError('åŠ è½½å¤±è´¥'); 
      } 
    }); 
    
    // æ ‡ç­¾é¡µåˆ‡æ¢ 
    function switchTab(tabName) { 
      // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€ 
      document.querySelectorAll('.tab').forEach(tab => { 
        tab.classList.remove('active'); 
      }); 
      event.target.classList.add('active'); 
      
      // æ›´æ–°å†…å®¹æ˜¾ç¤º 
      if (tabName === 'table') { 
        renderTable(); 
      } else { 
        renderModules(); 
      } 
    } 
    
    // æ¸²æŸ“å·¥å…·è¡¨æ ¼ 
    async function renderTable() { 
      const container = document.getElementById('contentContainer'); 
      container.innerHTML = ''; 
      
      const sectionDiv = document.createElement('div'); 
      sectionDiv.className = 'section-card'; 
      
      const header = document.createElement('div'); 
      header.className = 'section-header'; 
      header.textContent = 'ğŸ“‹å®‰å“å¼€å‘å·¥å…·åˆ—è¡¨'; 
      
      const contentDiv = document.createElement('div'); 
      contentDiv.className = 'section-content'; 
      
      // åˆ›å»ºè¡¨æ ¼ 
      const table = document.createElement('table'); 
      table.className = 'tools-table'; 
      
      // åˆ›å»ºè¡¨å¤´ 
      const thead = document.createElement('thead'); 
      const headerRow = document.createElement('tr'); 
      androidToolsConfig.toolsTable.headers.forEach(headerText => { 
        const th = document.createElement('th'); 
        th.textContent = headerText; 
        headerRow.appendChild(th); 
      }); 
      thead.appendChild(headerRow); 
      table.appendChild(thead); 
      
      // åˆ›å»ºè¡¨ä½“ 
      const tbody = document.createElement('tbody'); 
      androidToolsConfig.toolsTable.rows.forEach(rowData => { 
        const tr = document.createElement('tr'); 
        rowData.forEach(cellData => { 
          const td = document.createElement('td'); 
          // å¤„ç†åŒ…å«ä»£ç çš„å•å…ƒæ ¼ 
          if (typeof cellData === 'string' && cellData.includes('`')) { 
            td.innerHTML = cellData.replace(/`([^`]+)`/g, '<code>$1</code>'); 
          } else { 
            td.textContent = cellData; 
          } 
          tr.appendChild(td); 
        }); 
        tbody.appendChild(tr); 
      }); 
      table.appendChild(tbody); 
      
      contentDiv.appendChild(table); 
      sectionDiv.appendChild(header); 
      sectionDiv.appendChild(contentDiv); 
      container.appendChild(sectionDiv); 
    } 
    
    // æ¸²æŸ“å®‰è£…æ¨¡å— 
    async function renderModules() { 
      const container = document.getElementById('contentContainer'); 
      container.innerHTML = ''; 
      
      // è·å–å·²å®Œæˆçš„æ­¥éª¤ 
      const completedSteps = await IDB.get('E_android_completed_steps', 'userdata') || {}; 
      let totalSteps = 0; 
      let completedCount = 0; 
      
      androidToolsConfig.installModules.forEach((module, moduleIndex) => { 
        const moduleDiv = document.createElement('div'); 
        moduleDiv.className = 'section-card'; 
        
        // åˆ›å»ºæ ‡é¢˜ 
        const header = document.createElement('div'); 
        header.className = 'section-header'; 
        header.textContent = module.title; 
        
        // åˆ›å»ºå†…å®¹åŒº 
        const contentDiv = document.createElement('div'); 
        contentDiv.className = 'section-content'; 
        
        // åˆ›å»ºå‘½ä»¤å— 
        const commandBlock = document.createElement('div'); 
        commandBlock.className = 'command-block'; 
        
        // æ·»åŠ å¤åˆ¶æŒ‰é’® 
        const copyBtn = document.createElement('button'); 
        copyBtn.className = 'copy-btn'; 
        copyBtn.textContent = 'å¤åˆ¶'; 
        copyBtn.onclick = (e) => CommonPlugin.copyCommand(e, copyBtn); 
        
        // åˆ›å»ºä»£ç å†…å®¹ 
        const pre = document.createElement('pre'); 
        const code = document.createElement('code'); 
        code.className = 'language-bash'; 
        code.textContent = module.commands.join('\n'); 
        pre.appendChild(code); 
        
        commandBlock.appendChild(copyBtn); 
        commandBlock.appendChild(pre); 
        
        // åˆ›å»ºæ¨¡å—é¡¹ï¼ˆç”¨äºç‚¹å‡»æ ‡è®°å®Œæˆï¼‰ 
        const moduleItem = document.createElement('div'); 
        const moduleKey = `module_${moduleIndex}`; 
        const isCompleted = completedSteps[moduleKey]; 
        if (isCompleted) completedCount++; 
        totalSteps++; 
        
        moduleItem.className = `module-item ${isCompleted ? 'completed-step' : ''}`; 
        moduleItem.onclick = () => toggleModule(moduleKey, moduleItem); 
        
  
        
        moduleItem.appendChild(commandBlock); 
        contentDiv.appendChild(moduleItem); 
        moduleDiv.appendChild(header); 
        moduleDiv.appendChild(contentDiv); 
        container.appendChild(moduleDiv); 
      }); 
      
      // æ›´æ–°è¿›åº¦æ¡ 
      CommonPlugin.updateProgress(completedCount, totalSteps); 
      
      // åº”ç”¨Prismé«˜äº® 
      Prism.highlightAll(); 
    } 
    
    // åˆ‡æ¢æ¨¡å—å®ŒæˆçŠ¶æ€ 
    async function toggleModule(moduleKey, moduleElement) { 
      const completedSteps = await IDB.get('E_android_completed_steps', 'userdata') || {}; 
      completedSteps[moduleKey] = !completedSteps[moduleKey]; 
      await IDB.put('E_android_completed_steps', completedSteps, 'userdata'); 
      
      if (completedSteps[moduleKey]) { 
        moduleElement.classList.add('completed-step'); 
      } else { 
        moduleElement.classList.remove('completed-step'); 
      } 
      
      // é‡æ–°è®¡ç®—è¿›åº¦ 
      const totalSteps = document.querySelectorAll('.module-item').length; 
      const completedCount = document.querySelectorAll('.completed-step').length; 
      CommonPlugin.updateProgress(completedCount, totalSteps); 
    } 
    
    // ä¸»é¢˜åˆ‡æ¢ï¼ˆè°ƒç”¨æ’ä»¶ä¸­çš„æ–¹æ³•ï¼‰ 
    function switchTheme() { 
      CommonPlugin.switchTheme(); 
    } 
  </script> 
</body> 
</html>
