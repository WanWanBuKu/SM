<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ°´å°ç”Ÿæˆå™¨</title>
    
    <!-- prism.js è¯­æ³•é«˜äº® -->
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶ç¼“å­˜-CDN/1.prismä»£ç é«˜äº®/1.prism-css-ç™½è‰²ä¸»é¢˜.js"></script>   
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶ç¼“å­˜-CDN/1.prismä»£ç é«˜äº®/prism-core.min.js"></script>
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶ç¼“å­˜-CDN/1.prismä»£ç é«˜äº®/prism-bash.min.js"></script>
    
    <!-- å¼•å…¥ç¼©æ”¾æ’ä»¶ -->
    <script src="/A2_å…¨å±€ä¸­å¿ƒ/B_æ’ä»¶å·¥å…·/3.æ’ä»¶_å­—ä½“ç¼©æ”¾.js"></script>
    
    <style>
        /* 1. åŸºç¡€æ ·å¼é‡ç½® */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* 2. é¡µé¢ä¸»ä½“æ ·å¼ - æ–°çš„æ¸å˜èƒŒæ™¯ */
        body { 
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #2c3e50; 
            line-height: 1.5; 
            padding: 10px; 
            min-height: 100vh; 
        }
        
        /* 3. ä¸»å®¹å™¨ */
        .container { max-width: 1400px; margin: 0 auto; animation: fadeIn 0.5s ease-in; }
        
        /* 4. é¡µé¢æ ‡é¢˜ - æ›´ç´§å‡‘ */
        h1 { 
            color: #ffffff; 
            margin-bottom: 15px; 
            font-size: 22px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); 
            animation: slideDown 0.6s ease-out; 
        }
        
        /* 5. ä»£ç å—å®¹å™¨ - æ›´å¤§çš„æ˜¾ç¤ºåŒºåŸŸ */
        .code-container { 
            background: #ffffff; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
            border: 1px solid #e1e8ed; 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            margin-bottom: 20px;
        }
        
        /* 6. ä»£ç å—æ‚¬åœæ•ˆæœ */
        .code-container:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25); }
        
        /* 7. ä»£ç å¤´éƒ¨ */
        .code-header { 
            background: linear-gradient(90deg, #4a5568 0%, #2d3748 100%); 
            padding: 12px 20px; 
            border-bottom: 1px solid #dee2e6; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        /* 8. ä»£ç æ ‡é¢˜ */
        .code-title { color: #ffffff; font-size: 14px; font-weight: 600; letter-spacing: 0.5px; }
        
        /* 9. å¤åˆ¶æŒ‰é’® - ç´«è‰²ä¸»é¢˜ */
        .copy-btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            padding: 6px 14px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.4); 
        }
        
        /* 10. å¤åˆ¶æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .copy-btn:hover { 
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); 
            transform: scale(1.05); 
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.5); 
        }
        
        /* 11. å¤åˆ¶æŒ‰é’®å·²å¤åˆ¶çŠ¶æ€ */
        .copy-btn.copied { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        
        /* 12. ä»£ç å†…å®¹åŒº - æ›´å°å­—ä½“ï¼Œæ›´å¤§åŒºåŸŸ */
        pre { 
            background: #f7fafc; 
            padding: 15px; 
            overflow-x: auto; 
            font-size: 11px; 
            line-height: 1.4; 
            border-radius: 0 0 12px 12px; 
            margin: 0; 
            max-height: 70vh; 
            overflow-y: auto; 
        }
        
        /* 13. ä»£ç æ ‡ç­¾ */
        code { color: #2d3748; font-family: inherit; white-space: pre; }
        
        /* 14. è¯´æ˜åŒºåŸŸ - è·Ÿéšæ»šåŠ¨ */
        .info-section { 
            margin-top: 0; 
            padding: 15px; 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 12px; 
            backdrop-filter: blur(10px); 
            border: 1px solid #e1e8ed; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* 15. ä¿¡æ¯åŒºæ ‡é¢˜ */
        .info-section h2 { color: #667eea; margin-bottom: 10px; font-size: 18px; }
        
        /* 16. ä¿¡æ¯ç½‘æ ¼å¸ƒå±€ */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; margin-top: 10px; }
        
        /* 17. ä¿¡æ¯é¡¹ */
        .info-item { 
            background: rgba(248, 249, 250, 0.9); 
            padding: 10px; 
            border-radius: 8px; 
            border-left: 3px solid #667eea; 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        
        /* 18. ä¿¡æ¯é¡¹æ‚¬åœæ•ˆæœ */
        .info-item:hover { transform: translateX(5px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        
        /* 19. ä¿¡æ¯æ ‡ç­¾ */
        .info-label { color: #718096; font-size: 11px; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        /* 20. ä¿¡æ¯å†…å®¹ */
        .info-content { color: #2d3748; font-size: 12px; }
        
        /* 21. Toastæç¤º */
        .toast { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: #667eea; 
            color: white; 
            padding: 12px 20px; 
            border-radius: 6px; 
            font-size: 14px; 
            z-index: 1000; 
            opacity: 0; 
            transform: translateY(10px); 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
        }
        
        /* 22. Toastæ˜¾ç¤ºçŠ¶æ€ */
        .toast.show { opacity: 1; transform: translateY(0); }
        
        /* 23. å“åº”å¼è®¾è®¡ - ä¼˜åŒ–ç«–å± */
        @media (max-width: 768px) { 
            body { padding: 8px; } 
            pre { 
                padding: 12px; 
                font-size: 10px; 
                max-height: 75vh; 
            } 
            .info-grid { grid-template-columns: 1fr; }
            h1 { font-size: 20px; margin-bottom: 10px; }
        }
        
        /* 24. åŠ¨ç”»å®šä¹‰ */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* 25. æ»‘å…¥åŠ¨ç”» */
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 26. æ»šåŠ¨æ¡ç¾åŒ– */
        pre::-webkit-scrollbar { width: 8px; height: 8px; }
        pre::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        pre::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        pre::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¸ å›¾ç‰‡æ°´å°ç”Ÿæˆå™¨</h1>
        
        <div class="code-container">
            <div class="code-header">
                <span class="code-title">watermark_generator.sh</span>
                <button class="copy-btn" id="copyBtn">
                    <span>ğŸ“‹</span>
                    <span id="copyBtnText">å¤åˆ¶</span>
                </button>
            </div>
            <pre><code id="codeContent" class="language-bash">#!/bin/bash

# 1. ================= å­—ä½“è®¾ç½® =================
# è‡ªåŠ¨å¯»æ‰¾å®‰å“æˆ–Linuxä¸­æ–‡å­—ä½“
FONT_PATH=""
possible_fonts=(
    "/system/fonts/NotoSansCJK-Regular.ttc"
    "/system/fonts/DroidSansFallback.ttf"
    "/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc"
    "/usr/share/fonts/wqy-zenhei/wqy-zenhei.ttc"
)

for font in "${possible_fonts[@]}"; do
    if [ -f "$font" ]; then
        FONT_PATH="$font"
        break
    fi
done

[ -z "$FONT_PATH" ] && FONT_PATH="sans-serif" # æ‰¾ä¸åˆ°è¿™å°±å›é€€
# ===========================================

# 2. æ£€æŸ¥ä¾èµ–
command -v magick >/dev/null || { echo "è¯·å…ˆå®‰è£…: pkg install imagemagick"; exit 1; }

# 3. è·å–è¾“å…¥
read -p "è¯·è¾“å…¥å›¾ç‰‡è·¯å¾„: " image_path
[ -f "$image_path" ] || { echo "æ–‡ä»¶ä¸å­˜åœ¨"; exit 1; }

# 4. === è·å–å›¾ç‰‡å®½åº¦ï¼Œè®¡ç®—æ¯”ä¾‹ ===
width=$(magick identify -format "%w" "$image_path")

# è®¡ç®—å­—å· (æ ¹æ®å›¾ç‰‡å®½åº¦åŠ¨æ€è°ƒæ•´)
# æ—¶é—´å¤§å­—: 18% å®½åº¦
fs_time=$(echo "$width * 0.18" | bc | cut -d. -f1)
# æ—¥æœŸå°å­—: 4.5% å®½åº¦
fs_meta=$(echo "$width * 0.045" | bc | cut -d. -f1)
# å³ä¸‹è§’Logoå­—: 3.5% å®½åº¦
fs_logo=$(echo "$width * 0.035" | bc | cut -d. -f1)

# 5. é—´è·æ§åˆ¶
margin_bottom=$(echo "$width * 0.08" | bc | cut -d. -f1) # æ•´ä½“ç¦»åº•éƒ¨çš„è·ç¦»
icon_size=$(echo "$fs_meta * 1.2" | bc | cut -d. -f1)    # çº¢è‰²å›¾æ ‡å¤§å°
logo_icon_size=$(echo "$fs_logo * 1.5" | bc | cut -d. -f1) # ç›¸æœºå›¾æ ‡å¤§å°

# 6. === æ–‡æœ¬å†…å®¹ ===
current_time=$(date +"%H:%M")
current_date=$(date +"%Y-%m-%d")
# ä¸­æ–‡æ˜ŸæœŸå¤„ç†
week_num=$(date +"%u")
case $week_num in
    1) w="ä¸€";; 2) w="äºŒ";; 3) w="ä¸‰";; 4) w="å››";; 5) w="äº”";; 6) w="å…­";; 7) w="æ—¥";;
esac
date_str="$current_date æ˜ŸæœŸ$w"
location_str="ä¸Šæµ·å¸‚ Â· é™å®‰åŒº"

# 7. è¾“å‡ºæ–‡ä»¶å
dir=$(dirname "$image_path")
filename=$(basename "$image_path")
output_file="$dir/${filename%.*}_æ°´å°V2.jpg"

echo "æ­£åœ¨ç”Ÿæˆå®Œç¾æ°´å°..."

# 8. ================= å›¾åƒå¤„ç†é€»è¾‘ =================
# è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š
# 1. åˆ¶ä½œ [çº¢ç‚¹å›¾æ ‡]ï¼šåœ¨ 100x100 çš„å›ºå®šç”»å¸ƒä¸Šç”»ï¼Œç„¶åç¼©æ”¾åˆ°æ–‡å­—é«˜åº¦ã€‚
# 2. åˆ¶ä½œ [ç›¸æœºå›¾æ ‡]ï¼šåŒä¸Šï¼Œå›ºå®šç”»å¸ƒç”»å¥½ï¼Œå†ç¼©æ”¾ã€‚
# 3. æ‹¼æ¥ [æ—¥æœŸ+çº¢ç‚¹+åœ°ç‚¹]ï¼šæ¨ªå‘æ‹¼æ¥ã€‚
# 4. ç»„åˆ [æ—¶é—´] å’Œ [ä¸Šé¢é‚£è¡Œ]ï¼šçºµå‘å åŠ ã€‚
# 5. åˆæˆåˆ°åº•å›¾ã€‚

magick "$image_path" \
    \
    \( \
        \
        \( -background none -fill white -font "$FONT_PATH" -pointsize "$fs_time" label:"$current_time" \) \
        \
        \( \
            \( -background none -fill white -font "$FONT_PATH" -pointsize "$fs_meta" label:"$date_str " \) \
            \
            \( -size 100x100 xc:none -fill "#FF2222" \
               -draw "circle 50,40 50,75" \
               -draw "path 'M 20,45 L 50,100 L 80,45 Z'" \
               -draw "circle 50,40 50,50" \
               -resize x"$icon_size" \) \
            \
            \( -background none -fill white -font "$FONT_PATH" -pointsize "$fs_meta" label:" $location_str" \) \
            \
            -gravity Center +append \
        \) \
        \
        -gravity Center -append -background none \
    \) \
    -gravity South -geometry +0+"$margin_bottom" -composite \
    \
    \( \
        \( -size 100x100 xc:none -stroke white -strokewidth 8 -fill none \
           -draw "roundrectangle 5,20 95,80 10,10" \
           -stroke none -fill white \
           -draw "circle 50,50 50,65" \
           -draw "rectangle 70,25 85,35" \
           -resize x"$logo_icon_size" \
        \) \
        \( -background none -fill white -font "$FONT_PATH" -pointsize "$fs_logo" label:" æ°´å°ç›¸æœº" \) \
        -gravity Center +append \
    \) \
    -gravity SouthEast -geometry +"$(($width/30))"+"$(($width/40))" -composite \
    \
    "$output_file"

# 9. å®Œæˆ
echo "âœ… å®Œæˆï¼è¯·æŸ¥çœ‹: $output_file"</code></pre>
        </div>
        
        <div class="info-section">
            <h2>ğŸ“‹ è„šæœ¬è¯´æ˜</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">ğŸ¯ åŠŸèƒ½</div>
                    <div class="info-content">ä¸ºå›¾ç‰‡æ·»åŠ ä¸“ä¸šçš„æ—¶é—´åœ°ç‚¹æ°´å°ï¼Œæ”¯æŒä¸­æ–‡æ˜¾ç¤º</div>
                    <div class="info-content">è¯´æ˜ï¼Œè‹¥éœ€è¦å®šåˆ¶ï¼Œåˆ™éœ€ä¿®æ”¹ç»˜ç”»é€»è¾‘</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ğŸ“ è¾“å‡º</div>
                    <div class="info-content">åœ¨åŸå›¾ç‰‡åŒç›®å½•ç”Ÿæˆ ${filename}_æ°´å°V2.jpg</div>
                </div>
                <div class="info-item">
                    <div class="info-label">âš¡ ç‰¹æ€§</div>
                    <div class="info-content">è‡ªåŠ¨é€‚é…å›¾ç‰‡å°ºå¯¸ã€æ™ºèƒ½å­—ä½“æ£€æµ‹ã€åŠ¨æ€è®¡ç®—å¸ƒå±€</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ğŸ› ï¸ ä¾èµ–</div>
                    <div class="info-content">éœ€è¦å®‰è£… ImageMagick (magickå‘½ä»¤)</div>
                    <div class="info-label">ğŸ’¡ æç¤ºï¼šä¿å­˜ä¸º.shæ–‡ä»¶åè¿è¡Œ</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ğŸ¨ æ°´å°å…ƒç´ </div>
                    <div class="info-content">æ—¶é—´ã€æ—¥æœŸã€æ˜ŸæœŸã€ä½ç½®ã€çº¢è‰²å®šä½ç‚¹ã€ç›¸æœºå›¾æ ‡</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ğŸ“± é€‚ç”¨å¹³å°</div>
                    <div class="info-content">æ”¯æŒAndroid (Termux)ã€Linuxç­‰ç³»ç»Ÿ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast æç¤º -->
    <div class="toast" id="toast"></div>

    <script>
        // 1. å¤åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶å¤„ç†
        document.getElementById('copyBtn').addEventListener('click', function() {
            const copyBtn = this;
            const copyBtnText = document.getElementById('copyBtnText');
            const toast = document.getElementById('toast');
            
            // è·å–çº¯æ–‡æœ¬å†…å®¹ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
            const codeElement = document.getElementById('codeContent');
            const textContent = codeElement.textContent || codeElement.innerText;
            
            // ä½¿ç”¨ç°ä»£APIå¤åˆ¶
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textContent).then(function() {
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    handleCopySuccess(copyBtn, copyBtnText, toast);
                }).catch(function(err) {
                    showCopyError(copyBtn, copyBtnText, toast);
                });
            } else {
                // å¤‡ç”¨æ–¹æ³•
                fallbackCopy(textContent, copyBtn, copyBtnText, toast);
            }
        });
        
        // 2. å¤„ç†å¤åˆ¶æˆåŠŸ
        function handleCopySuccess(copyBtn, copyBtnText, toast) {
            copyBtn.classList.add('copied');
            copyBtnText.textContent = 'å·²å¤åˆ¶';
            
            // æ˜¾ç¤ºtoast
            toast.textContent = 'âœ… è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
            toast.classList.add('show');
            
            // 2ç§’åæ¢å¤æŒ‰é’®çŠ¶æ€
            setTimeout(function() {
                copyBtn.classList.remove('copied');
                copyBtnText.textContent = 'å¤åˆ¶';
            }, 2000);
            
            // 3ç§’åéšè—toast
            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 3. å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopy(text, copyBtn, copyBtnText, toast) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    handleCopySuccess(copyBtn, copyBtnText, toast);
                } else {
                    showCopyError(copyBtn, copyBtnText, toast);
                }
            } catch (err) {
                showCopyError(copyBtn, copyBtnText, toast);
            }
            
            document.body.removeChild(textArea);
        }
        
        // 4. æ˜¾ç¤ºå¤åˆ¶é”™è¯¯
        function showCopyError(copyBtn, copyBtnText, toast) {
            // æ˜¾ç¤ºé”™è¯¯æç¤º
            toast.textContent = 'âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶';
            toast.style.background = '#e74c3c';
            toast.classList.add('show');
            
            // 3ç§’åéšè—toast
            setTimeout(function() {
                toast.classList.remove('show');
                toast.style.background = '#667eea';
            }, 3000);
        }
    </script>
</body>
</html>
