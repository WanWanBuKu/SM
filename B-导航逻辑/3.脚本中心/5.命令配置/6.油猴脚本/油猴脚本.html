<!DOCTYPE html> 
<html lang="zh-CN"> 
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è„šæœ¬ä¸­å¿ƒ- ä»£ç æŸ¥çœ‹å™¨</title> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root { 
            --primary-color: #0ea5e9; 
            --secondary-color: #06b6d4;
            --text-primary: #0f172a; 
            --text-secondary: #64748b; 
            --bg-color: #f8fafc; 
            --card-bg: #ffffff; 
            --border-color: #e2e8f0; 
            --success-color: #10b981; 
            --warning-color: #f59e0b; 
            --info-color: #3b82f6; 
            --code-bg: #1e293b; 
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        } 
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); 
            min-height: 100vh; 
            color: var(--text-primary); 
            position: relative; 
            overflow-x: hidden; 
        }
        body::before { 
            content: ''; 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: radial-gradient(circle at 20% 50%, rgba(14, 165, 233, 0.1) 0%, transparent 50%), 
                        radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%); 
            z-index: 0; 
        }
        .container { 
            max-width: 100%; 
            padding: 15px 10px; 
            position: relative; 
            z-index: 1; 
            transition: transform 0.3s ease, font-size 0.3s ease; 
            transform-origin: top center; 
        }
        #homeView { 
            display: block; 
            min-height: 100vh; 
            padding-bottom: 20px; 
        }
        #codeView { 
            display: none; 
            min-height: 100vh; 
            background: var(--code-bg); 
            color: #e2e8f0; 
            transition: transform 0.3s ease; 
        }
        header { 
            text-align: center; 
            color: white; 
            margin-bottom: 20px; 
            animation: fadeInDown 0.8s ease; 
        }
        h1 { 
            font-size: 28px; 
            font-weight: 700; 
            margin-bottom: 8px; 
            text-shadow: 0 4px 6px rgba(0,0,0,0.3); 
            background: linear-gradient(135deg, #60a5fa, #a78bfa); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        .subtitle { 
            font-size: 14px; 
            opacity: 0.9; 
            font-weight: 300; 
            color: #cbd5e1; 
        }
        .scripts-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin-top: 20px; 
        }
        .script-card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            border-radius: 12px; 
            padding: 12px; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
            animation: fadeInUp 0.6s ease; 
            transition: all 0.3s ease; 
            cursor: pointer; 
            position: relative; 
            overflow: hidden; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
        }
        .script-card::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 3px; 
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); 
        }
        .script-card:hover { 
            transform: translateY(-4px) scale(1.02); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15); 
        }
        .script-icon { 
            width: 32px; 
            height: 32px; 
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: 8px; 
            font-size: 16px; 
            color: white; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
        }
        .script-title { 
            font-size: 14px; 
            font-weight: 600; 
            color: var(--text-primary); 
            margin-bottom: 4px; 
        }
        .script-description { 
            font-size: 11px; 
            color: var(--text-secondary); 
            line-height: 1.4; 
            margin-bottom: 8px; 
        }
        .script-meta { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 9px; 
            color: var(--text-secondary); 
        }
        .script-size { 
            background: var(--bg-color); 
            padding: 2px 4px; 
            border-radius: 3px; 
        }
        .script-status { 
            font-size: 9px; 
            padding: 2px 4px; 
            border-radius: 3px; 
        } 
        .script-status.loaded { 
            background: var(--success-color); 
            color: white; 
        } 
        .pagination { 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            margin-top: 20px; 
        }
        .page-btn { 
            background: rgba(255, 255, 255, 0.1); 
            color: white; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            padding: 6px 12px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.2s ease; 
        }
        .page-btn:hover { 
            background: rgba(255, 255, 255, 0.2); 
        } 
        .page-btn.active { 
            background: var(--primary-color); 
            border-color: var(--primary-color); 
        }
        .code-header { 
            background: #0f172a; 
            padding: 12px 15px; 
            border-bottom: 1px solid #334155; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .code-title { 
            font-size: 14px; 
            font-weight: 500; 
            color: #e2e8f0; 
            text-align: center; 
            margin-bottom: 10px; 
        }
        .code-controls { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 10px; 
        }
        .control-btn, .copy-btn, .back-btn { 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            padding: 6px 12px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 12px; 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            gap: 4px; 
        }
        .control-btn:hover, .copy-btn:hover, .back-btn:hover { 
            background: var(--secondary-color); 
            transform: translateY(-1px); 
        }
        .control-panel { 
            position: fixed; 
            top: 80px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(30, 41, 59, 0.95); 
            backdrop-filter: blur(10px); 
            border-radius: 12px; 
            padding: 15px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); 
            z-index: 999; 
            display: none; 
            min-width: 250px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .control-panel.show { 
            display: block; 
            animation: slideIn 0.3s ease; 
        } 
        .control-group { 
            margin-bottom: 12px; 
        } 
        .control-group:last-child { 
            margin-bottom: 0; 
        } 
        .control-label { 
            color: #cbd5e1; 
            font-size: 12px; 
            font-weight: 500; 
            margin-bottom: 6px; 
            display: block; 
        }
        .control-buttons { 
            display: flex; 
            gap: 6px; 
            flex-wrap: wrap; 
        } 
        .control-btn-small { 
            background: #334155; 
            color: #e2e8f0; 
            border: none; 
            padding: 4px 8px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 11px; 
            transition: all 0.2s ease; 
        }
        .control-btn-small:hover { 
            background: #475569; 
        } 
        .control-btn-small.active { 
            background: var(--primary-color); 
        } 
        .code-container { 
            padding: 15px; 
            overflow-x: auto; 
            max-height: calc(100vh - 120px); 
            overflow-y: auto; 
        }
        pre[class*="language-"] { 
            margin: 0; 
            padding: 15px; 
            background: var(--code-bg); 
            border-radius: 0; 
            font-size: 12px; 
            line-height: 1.4; 
        }
        .loading { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 150px; 
            color: #94a3b8; 
        }
        .error { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 150px; 
            color: #f87171; 
            flex-direction: column; 
            gap: 8px; 
            font-size: 14px; 
        }
        .toast { 
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: var(--success-color); 
            color: white; 
            padding: 8px 16px; 
            border-radius: 6px; 
            font-size: 12px; 
            z-index: 10000; 
            opacity: 0; 
            transition: opacity 0.3s ease; 
        }
        .toast.show { 
            opacity: 1; 
        } 
        .toast.error { 
            background: #ef4444; 
        }
        .db-tip {
            position: fixed;
            bottom: 5px;
            right: 10px;
            color: rgba(0, 255, 0, 0.15);
            font-size: 8px;
            z-index: 10000;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            z-index: 10001;
            max-width: 300px;
            word-wrap: break-word;
        }
        @keyframes fadeInDown { 
            from { 
                opacity: 0; 
                transform: translateY(-20px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        @keyframes fadeInUp { 
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        @keyframes slideIn { 
            from { 
                opacity: 0; 
                transform: translateX(-50%) translateY(-10px); 
            } 
            to { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0); 
            } 
        }
        @media (min-width: 768px) { 
            .container { 
                max-width: 768px; 
                margin: 0 auto; 
            } 
            .scripts-grid { 
                grid-template-columns: repeat(4, 1fr); 
                gap: 15px; 
            } 
        }
        .rotate-90 { 
            transform: rotate(90deg); 
        } 
        .rotate-180 { 
            transform: rotate(180deg); 
        } 
        .rotate-270 { 
            transform: rotate(270deg); 
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»é¡µè§†å›¾-->
        <div id="homeView">
            <header>
                <h1>ğŸ“œè„šæœ¬ä¸­å¿ƒ</h1> 
                <p class="subtitle">ç²¾é€‰å®ç”¨è„šæœ¬ï¼Œä¸€é”®æŸ¥çœ‹æºç </p> 
            </header>
            <main class="scripts-grid" id="scriptsGrid">
                <!-- åŠ¨æ€ç”Ÿæˆçš„è„šæœ¬å¡ç‰‡-->
            </main>
            <div class="pagination" id="pagination">
                <!-- åŠ¨æ€ç”Ÿæˆçš„åˆ†é¡µæŒ‰é’®-->
            </div>
        </div>
        
        <!-- ä»£ç æŸ¥çœ‹è§†å›¾-->
        <div id="codeView">
            <div class="code-header">
                <div class="code-title" id="codeTitle">è„šæœ¬ä»£ç </div> 
                <div class="code-controls">
                    <button class="control-btn" onclick="toggleControlPanel()">
                        âš™ï¸æ§åˆ¶é¢æ¿
                    </button>
                    <button class="copy-btn" onclick="copyCode()">
                        ğŸ“‹å¤åˆ¶ä»£ç 
                    </button>
                    <button class="back-btn" onclick="backToHome()">
                        â†è¿”å› 
                    </button> 
                </div>
            </div>
            <div class="control-panel" id="controlPanel">
                <div class="control-group">
                    <span class="control-label">ç¼©æ”¾</span> 
                    <div class="control-buttons">
                        <button class="control-btn-small" onclick="adjustZoom(-0.1)">ç¼©å°</button>
                        <button class="control-btn-small" onclick="adjustZoom(0.1)">æ”¾å¤§</button>
                        <button class="control-btn-small" onclick="resetZoom()">é‡ç½®</button>
                    </div>
                </div>
                <div class="control-group">
                    <span class="control-label">å­—ä½“</span> 
                    <div class="control-buttons">
                        <button class="control-btn-small" onclick="adjustFontSize(-2)">A-</button>
                        <button class="control-btn-small" onclick="adjustFontSize(2)">A+</button>
                        <button class="control-btn-small" onclick="resetFontSize()">é‡ç½®</button>
                    </div>
                </div>
                <div class="control-group">
                    <span class="control-label">æ—‹è½¬</span> 
                    <div class="control-buttons">
                        <button class="control-btn-small" onclick="rotateScreen(0)">0Â°</button>
                        <button class="control-btn-small" onclick="rotateScreen(90)">90Â°</button>
                        <button class="control-btn-small" onclick="rotateScreen(180)">180Â°</button>
                        <button class="control-btn-small" onclick="rotateScreen(270)">270Â°</button>
                    </div>
                </div>
            </div>
            <div class="code-container" id="codeContainer">
                <div class="loading">æ­£åœ¨åŠ è½½ä»£ç ...</div> 
            </div>
        </div>
        
        <!-- Toast æç¤º-->
        <div class="toast" id="toast"></div>
        <!-- æ•°æ®åº“åŠ è½½æç¤º -->
        <div class="db-tip" id="dbTip"></div>
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="debug-info" id="debugInfo" style="display: none;"></div>
    </div>

    <!-- â‘ æ•°æ®åº“å…¬å…±åº“ï¼ˆæ°¸ä¸æ”¹åï¼‰-->
    <script src="/db.js"></script>
    
    <!-- â‘¢é¡µé¢é€»è¾‘-->
    <script>
        // ===== è°ƒè¯•é…ç½® =====
        const DEBUG = true; // è®¾ç½®ä¸º false å¯å…³é—­è°ƒè¯•ä¿¡æ¯

        // ===== è°ƒè¯•å‡½æ•° =====
        function debugLog(message, type = 'info') {
            if (!DEBUG) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const debugInfo = document.getElementById('debugInfo');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            
            debugInfo.textContent += logEntry;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            
            console.log(`[DEBUG] ${logEntry.trim()}`);
        }

        // æ˜¾ç¤º/éšè—è°ƒè¯•ä¿¡æ¯
        function toggleDebug() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
        }

        // ===== ç¦»çº¿ç¼“å­˜ç®¡ç†å™¨ =====
        const CacheMgr = {
            async get(file) {
                debugLog(`å°è¯•åŠ è½½æ–‡ä»¶: ${file}`, 'info');
                
                try {
                    // â‘  ä¼˜å…ˆè¯»åº“
                    const txt = await IDB.get(file);
                    if (txt) {
                        debugLog(`æ•°æ®åº“å‘½ä¸­: ${file}`, 'success');
                        console.log('âš¡DB å‘½ä¸­', file);
                        showDbTip('âš¡ä»æ•°æ®åº“åŠ è½½');
                        return txt;
                    }

                    debugLog(`æ•°æ®åº“æœªå‘½ä¸­ï¼Œå¼€å§‹ç½‘ç»œè¯·æ±‚: ${file}`, 'info');
                    console.log('ğŸŒé¦–æ¬¡æ‹‰å–', file);
                    
                    // â‘¡ åº“æ²¡æœ‰æ‰ fetch
                    const resp = await fetch(file);
                    if (!resp.ok) {
                        const errorMsg = `æ–‡ä»¶åŠ è½½å¤±è´¥: ${file} (çŠ¶æ€: ${resp.status})`;
                        debugLog(errorMsg, 'error');
                        throw new Error(errorMsg);
                    }
                    
                    const text = await resp.text();
                    debugLog(`æ–‡ä»¶åŠ è½½æˆåŠŸï¼Œå¤§å°: ${text.length} å­—ç¬¦`, 'success');
                    
                    // â‘¢ ç«‹å³å†™åº“
                    await IDB.put(file, text);
                    debugLog(`æ–‡ä»¶å·²ç¼“å­˜åˆ°æ•°æ®åº“: ${file}`, 'success');
                    
                    return text;
                } catch (error) {
                    debugLog(`åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                    throw error;
                }
            }
        };

        // è„šæœ¬é…ç½®
        const scriptsConfig = [
            { 
                id: 'script1', 
                name: 'æ²¹çŒ´1_è§£é™¤ç½‘ç«™ä¸è®¸å¤åˆ¶2.0.16.js', 
                title: 'è§£é™¤ç½‘ç«™å¤åˆ¶é™åˆ¶', 
                description: 'è§£é™¤ç½‘ç«™ç¦æ­¢å¤åˆ¶çš„é™åˆ¶ï¼Œè®©æ‚¨å¯ä»¥è‡ªç”±å¤åˆ¶ç½‘é¡µå†…å®¹', 
                icon: 'ğŸ”“', 
                size: '2.5KB' 
            },
            { 
                id: 'script2', 
                name: 'æ²¹çŒ´2_æ­£å¸¸ä¸Šç½‘.js', 
                title: 'ç½‘ç»œè®¿é—®åŠ©æ‰‹', 
                description: 'å¸®åŠ©æ‚¨æ­£å¸¸è®¿é—®ç½‘ç»œï¼Œçªç ´è®¿é—®é™åˆ¶', 
                icon: 'ğŸŒ', 
                size: '1.8KB' 
            }
        ];

        // æ§åˆ¶é¢æ¿åŠŸèƒ½
        let currentZoom = 1;
        let currentFontSize = 12;
        let currentRotation = 0;
        let currentPage = 1;
        const itemsPerPage = 8;
        let currentCode = '';

        function toggleControlPanel() {
            const panel = document.getElementById('controlPanel');
            panel.classList.toggle('show');
        }

        function adjustZoom(delta) {
            currentZoom = Math.max(0.5, Math.min(2, currentZoom + delta));
            document.getElementById('codeView').style.transform = 
                `scale(${currentZoom}) rotate(${currentRotation}deg)`;
        }

        function resetZoom() {
            currentZoom = 1;
            document.getElementById('codeView').style.transform = 
                `scale(${currentZoom}) rotate(${currentRotation}deg)`;
        }

        function adjustFontSize(delta) {
            currentFontSize = Math.max(10, Math.min(20, currentFontSize + delta));
            const codeElements = document.querySelectorAll('pre[class*="language-"]');
            codeElements.forEach(el => { 
                el.style.fontSize = currentFontSize + 'px'; 
            });
        }

        function resetFontSize() {
            currentFontSize = 12;
            const codeElements = document.querySelectorAll('pre[class*="language-"]');
            codeElements.forEach(el => { 
                el.style.fontSize = currentFontSize + 'px'; 
            });
        }

        function rotateScreen(degrees) {
            currentRotation = degrees;
            document.getElementById('codeView').style.transform = 
                `scale(${currentZoom}) rotate(${currentRotation}deg)`;
        }

        function copyCode() {
            if (currentCode) {
                navigator.clipboard.writeText(currentCode).then(() => {
                    showToast('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    debugLog('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
                    debugLog('ä»£ç å¤åˆ¶å¤±è´¥', 'error');
                });
            } else {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„ä»£ç ');
                debugLog('æ²¡æœ‰å¯å¤åˆ¶çš„ä»£ç ', 'warning');
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show';
            if (type === 'error') {
                toast.classList.add('error');
            }
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤ºæ•°æ®åº“åŠ è½½æç¤º
        function showDbTip(message) {
            const tip = document.getElementById('dbTip');
            tip.textContent = message;
            tip.style.opacity = '1';
            setTimeout(() => {
                tip.style.opacity = '0';
            }, 2000);
        }

        // æ¸²æŸ“è„šæœ¬å¡ç‰‡
        function renderScriptCards() {
            debugLog('å¼€å§‹æ¸²æŸ“è„šæœ¬å¡ç‰‡', 'info');
            
            const grid = document.getElementById('scriptsGrid');
            const pagination = document.getElementById('pagination');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentScripts = scriptsConfig.slice(startIndex, endIndex);

            grid.innerHTML = '';
            currentScripts.forEach((script, index) => {
                const card = document.createElement('div');
                card.className = 'script-card';
                card.style.animationDelay = `${index * 0.05}s`;
                
                // ç›´æ¥æ˜¾ç¤ºå·²åŠ è½½çŠ¶æ€ï¼ˆå› ä¸ºè„šæœ¬å·²ç»é€šè¿‡scriptæ ‡ç­¾åŠ è½½æ‰§è¡Œï¼‰
                card.innerHTML = `
                    <div class="script-icon">${script.icon}</div>
                    <div class="script-title">${script.title}</div>
                    <div class="script-description">${script.description}</div>
                    <div class="script-meta">
                        <span class="script-name">${script.name}</span>
                        <span class="script-size">${script.size}</span>
                        <span class="script-status loaded">å·²åŠ è½½</span>
                    </div>
                `;
                card.onclick = () => viewCode(script);
                grid.appendChild(card);
            });

            // æ¸²æŸ“åˆ†é¡µ
            const totalPages = Math.ceil(scriptsConfig.length / itemsPerPage);
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = 'page-btn';
                if (i === currentPage) btn.classList.add('active');
                btn.textContent = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderScriptCards();
                };
                pagination.appendChild(btn);
            }
            
            debugLog(`è„šæœ¬å¡ç‰‡æ¸²æŸ“å®Œæˆï¼Œå…± ${currentScripts.length} ä¸ª`, 'success');
        }

        // æŸ¥çœ‹ä»£ç 
        async function viewCode(script) {
            debugLog(`å¼€å§‹æŸ¥çœ‹ä»£ç : ${script.name}`, 'info');
            
            // åˆ‡æ¢è§†å›¾
            document.getElementById('homeView').style.display = 'none';
            document.getElementById('codeView').style.display = 'block';
            document.getElementById('codeTitle').textContent = script.name;

            // é‡ç½®æ§åˆ¶é¢æ¿çŠ¶æ€
            resetZoom();
            resetFontSize();
            rotateScreen(0);

            try {
                // åŠ è½½Prism.js
                if (!window.Prism) {
                    debugLog('åŠ è½½ Prism.js', 'info');
                    await loadScript('https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js');
                    await loadScript('https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js');
                    debugLog('Prism.js åŠ è½½å®Œæˆ', 'success');
                }

                // åŠ è½½è„šæœ¬å†…å®¹ï¼ˆä½¿ç”¨ç¼“å­˜ç®¡ç†å™¨ï¼‰
                const code = await CacheMgr.get(script.name);
                currentCode = code;

                // æ˜¾ç¤ºä»£ç 
                const container = document.getElementById('codeContainer');
                container.innerHTML = `<pre><code class="language-javascript">${escapeHtml(code)}</code></pre>`;

                // åº”ç”¨é«˜äº®
                if (window.Prism) {
                    Prism.highlightAll();
                }
                
                debugLog(`ä»£ç æ˜¾ç¤ºæˆåŠŸ: ${script.name}`, 'success');
            } catch (error) {
                debugLog(`ä»£ç åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                console.error('Error loading code:', error);
                
                // åŒºåˆ†é”™è¯¯ç±»å‹
                let errorMessage = 'åŠ è½½å¤±è´¥';
                let errorDetail = error.message;
                
                if (error.message.includes('æ•°æ®åº“')) {
                    errorMessage = 'æ•°æ®åº“åŠ è½½å¤±è´¥';
                } else if (error.message.includes('æ–‡ä»¶')) {
                    errorMessage = 'æ–‡ä»¶åŠ è½½å¤±è´¥';
                }
                
                document.getElementById('codeContainer').innerHTML = `
                    <div class="error">
                        <div>${errorMessage}</div>
                        <div>${errorDetail}</div>
                    </div>
                `;
                
                showToast(errorMessage, 'error');
            }
        }

        // è¿”å›ä¸»é¡µ
        function backToHome() {
            debugLog('è¿”å›ä¸»é¡µ', 'info');
            document.getElementById('codeView').style.display = 'none';
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('codeContainer').innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½ä»£ç ...</div>';
            currentCode = '';
            document.getElementById('controlPanel').classList.remove('show');
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // åŠ è½½å¤–éƒ¨è„šæœ¬
        function loadScript(url) {
            debugLog(`åŠ è½½å¤–éƒ¨è„šæœ¬: ${url}`, 'info');
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = url;
                s.onload = () => {
                    debugLog(`å¤–éƒ¨è„šæœ¬åŠ è½½æˆåŠŸ: ${url}`, 'success');
                    resolve(true);
                };
                s.onerror = () => {
                    debugLog(`å¤–éƒ¨è„šæœ¬åŠ è½½å¤±è´¥: ${url}`, 'error');
                    reject(new Error(`Failed to load script: ${url}`));
                };
                document.head.appendChild(s);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            debugLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–', 'info');
            
            try {
                // ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–
                debugLog('åˆå§‹åŒ–æ•°æ®åº“', 'info');
                await IDB.init();
                debugLog('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ', 'success');
                console.log('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ');

                // æ¸²æŸ“è„šæœ¬å¡ç‰‡
                renderScriptCards();
                showToast('è„šæœ¬ä¸­å¿ƒå·²åŠ è½½ï¼');
                debugLog('è„šæœ¬ä¸­å¿ƒåˆå§‹åŒ–å®Œæˆ', 'success');

                // åå°é™é»˜é¢„çƒ­ï¼Œä¸é˜»å¡æ¸²æŸ“
                debugLog('å¼€å§‹åå°é¢„çƒ­è„šæœ¬', 'info');
                scriptsConfig.forEach(s => {
                    CacheMgr.get(s.name).catch(error => {
                        debugLog(`é¢„çƒ­å¤±è´¥ ${s.name}: ${error.message}`, 'error');
                    });
                });
                
                debugLog('æ‰€æœ‰åˆå§‹åŒ–ä»»åŠ¡å®Œæˆ', 'success');
            } catch (error) {
                debugLog(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                
                // åŒºåˆ†é”™è¯¯ç±»å‹
                let errorMessage = 'åˆå§‹åŒ–å¤±è´¥';
                if (error.message.includes('æ•°æ®åº“')) {
                    errorMessage = 'æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥';
                }
                
                showToast(errorMessage, 'error');
            }
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­æ§åˆ¶é¢æ¿
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('controlPanel');
            const controls = document.querySelector('.code-controls');
            if (!panel.contains(e.target) && !controls.contains(e.target)) {
                panel.classList.remove('show');
            }
        });

        // å¿«æ·é”®ï¼šCtrl+D åˆ‡æ¢è°ƒè¯•ä¿¡æ¯
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                toggleDebug();
            }
        });

        // åˆå§‹åŒ–è°ƒè¯•ä¿¡æ¯
        debugLog('è„šæœ¬ä¸­å¿ƒå¯åŠ¨', 'info');
        debugLog(`è°ƒè¯•æ¨¡å¼: ${DEBUG ? 'å¼€å¯' : 'å…³é—­'}`, 'info');
        debugLog(`è„šæœ¬æ•°é‡: ${scriptsConfig.length}`, 'info');
    </script>
</body>
</html>
