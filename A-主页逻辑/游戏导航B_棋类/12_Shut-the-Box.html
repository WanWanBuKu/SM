<!DOCTYPE html> 
<html lang="zh-CN"> 
<head>
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Shut the Box</title> 
<style>
* { margin: 0; padding: 0; box-sizing: border-box; } 
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',Roboto, sans-serif;
background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
min-height: 100vh; display: flex; flex-direction: column; 
overflow-x: hidden; padding: 5px;
}
/* æˆ˜ç»©æ˜¾ç¤ºæ ·å¼*/
.stats-container {
position: fixed; top: 10px; left: 10px; 
background: rgba(255, 255, 255, 0.9); padding: 8px 12px; 
border-radius: 10px; font-size: 12px; color: #333; 
z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
} 
.stats-container span {
font-weight: bold; margin: 0 3px;
}
.win-stat { color: #4CAF50; } 
.lose-stat { color: #f5576c; }
/* ç¼©å°æ ‡é¢˜æ ·å¼*/
.game-title {
text-align: center; font-size: 18px;
font-weight: bold; color: white; margin: 5px 0; 
text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.game-container {
flex: 1; display: flex; flex-direction: column; 
padding: 10px; padding-bottom: 80px; 
max-width: 500px; margin: 0 auto; width: 100%;
}
.player-section {
background: rgba(255, 255, 255, 0.95); 
border-radius: 15px; padding: 15px; margin: 5px 0; 
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.player-section.active {
background: linear-gradient(135deg, #fff 0%, #ffeef8 100%); 
box-shadow: 0 0 30px rgba(245, 87, 108, 0.5);
}
.player-header {
display: flex; justify-content: space-between; 
align-items: center; margin-bottom: 10px;
}
.player-name {
font-size: 18px; font-weight: bold; color: #333;
}
.player-score {
font-size: 16px; color: #666;
}
.player-score span {
font-weight: bold; color: #f5576c; font-size: 20px;
}
.numbers-row {
display: flex; gap: 8px; justify-content: center; 
margin: 10px 0; flex-wrap: wrap;
}
.number-box {
width: 45px; height: 45px; 
background: linear-gradient(145deg, #ffffff, #f0f0f0); 
border: 2px solid #ddd; border-radius: 10px; 
display: flex; align-items: center; justify-content: center; 
font-size: 20px; font-weight: bold; color: #333; 
cursor: pointer; transition: all 0.2s ease; 
box-shadow: 3px 3px 8px rgba(0,0,0,0.1); 
user-select: none; -webkit-user-select: none; 
-webkit-tap-highlight-color: transparent;
}
.number-box:not(.closed):hover {
transform: translateY(-2px); 
box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
}
.number-box.selected {
background: linear-gradient(145deg, #f093fb,#f5576c) !important;
color: white !important; transform: translateY(-2px); 
box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); 
border-color: #f5576c;
}
.number-box.closed {
background: #f0f0f0 !important; color: #999 !important; 
transform: rotateX(90deg); opacity: 0.3; 
cursor: not-allowed; border-color: #ccc;
}
/* ä¿®æ”¹AI æ•°å­—æ¡†æ ·å¼- æ˜¾ç¤ºå®é™…æ•°å­—*/
.ai-number-box {
width: 45px; height: 45px; 
background: linear-gradient(145deg, #e8f4fd,#d1e7dd) !important;
border: 2px solid #4CAF50; border-radius: 10px; 
cursor: not-allowed; opacity: 0.9; 
display: flex; align-items: center; justify-content: center; 
font-size: 20px; font-weight: bold; color: #2E7D32; 
box-shadow: 3px 3px 8px rgba(0,0,0,0.1);
}
.ai-number-box.closed {
background: #f0f0f0 !important; color: #999 !important; 
transform: rotateX(90deg); opacity: 0.3; 
cursor: not-allowed; border-color: #ccc;
}
/* ä¸­å¤®éª°å­åŒºåŸŸ - åŒæ–¹å…±ç”¨ */
.dice-center {
background: rgba(255, 255, 255, 0.98); 
border-radius: 20px; padding: 20px; margin: 15px 0; 
box-shadow: 0 15px 40px rgba(0,0,0,0.25); 
text-align: center;
}
.dice-container {
display: flex; justify-content: center; 
align-items: center; gap: 20px; margin: 15px 0;
}
.dice {
width: 60px; height: 60px; background: white; 
border-radius: 12px; display: flex; 
align-items: center; justify-content: center; 
font-size: 28px; font-weight: bold; 
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
.dice.rolling {
animation: roll 0.6s ease-in-out;
}
@keyframes roll {
0% { transform: rotate(0deg) scale(1); } 
50% { transform: rotate(360deg) scale(1.2); } 
100% { transform: rotate(720deg) scale(1); }
}
.dice-sum {
font-size: 32px; font-weight: bold;
color: #f5576c; padding: 10px 20px; 
background: linear-gradient(135deg, #ffeef8, #fff0f5); 
border-radius: 15px;
}
.controls {
display: flex; gap: 10px; justify-content: center; 
margin-top: 15px; flex-wrap: wrap;
}
.btn {
padding: 12px 20px; border: none; border-radius: 25px; 
font-size: 14px; font-weight: bold; cursor: pointer; 
transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
user-select: none; -webkit-user-select: none; 
-webkit-tap-highlight-color: transparent;
}
.btn:active {
transform: scale(0.95);
}
.btn-primary {
background: linear-gradient(135deg, #f093fb, #f5576c); 
color: white;
}
.btn-success {
background: linear-gradient(135deg, #fa709a, #fee140); 
color: white;
}
.btn-warning {
background: linear-gradient(135deg, #ff9a9e, #fad0c4);
color: white;
}
.btn:disabled {
opacity: 0.5; cursor: not-allowed;
}
.status-bar {
background: rgba(255,255,255,0.9); padding: 8px; 
text-align: center; font-size: 14px; color: #666; 
margin: 5px 0; border-radius: 10px;
}
.selected-display {
background: rgba(255,255,255,0.9); padding: 10px; 
margin: 10px 0; border-radius: 10px; 
text-align: center; font-size: 16px; color: #333; 
min-height: 40px; display: flex; 
align-items: center; justify-content: center; gap: 10px;
}
.selected-number {
background: linear-gradient(145deg, #f093fb, #f5576c); 
color: white; padding: 5px 10px; 
border-radius: 5px; font-weight: bold;
}
.rules-btn {
position: fixed; bottom: 20px;
right: 20px; width: 50px; height: 50px; 
border-radius: 50%; background: linear-gradient(135deg, #f093fb, #f5576c); 
color: white; border: none; font-size: 20px; 
cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
z-index: 100;
}
.modal {
position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
background: rgba(0,0,0,0.8); display: none; 
align-items: center; justify-content: center; 
z-index: 1000; padding: 20px;
}
.modal.show {
display: flex;
}
.modal-content {
background: white; padding: 25px; 
border-radius: 20px; max-width: 400px; 
width: 100%; max-height: 80vh; overflow-y: auto;
}
.modal-title {
font-size: 24px; font-weight: bold;
color: #333; margin-bottom: 15px; text-align: center;
}
.modal-body {
color: #666; line-height: 1.6;
}
.modal-body h3 {
color: #f5576c; margin-top: 15px; margin-bottom: 8px;
}
.modal-body ul {
margin-left: 20px;
}
.modal-close {
margin-top: 20px; width: 100%; padding: 12px; 
background: linear-gradient(135deg, #f093fb, #f5576c); 
color: white; border: none; border-radius: 10px; 
font-size: 16px; font-weight: bold; cursor: pointer;
}
.game-over {
position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
background: rgba(0,0,0,0.8); display: none; 
align-items: center; justify-content: center; 
z-index: 1000;
}
.game-over.show {
display: flex;
}
.game-over-content {
background: white; padding: 30px; 
border-radius: 20px; text-align: center; 
max-width: 300px; width: 90%;
}
.winner-icon {
font-size: 60px; margin-bottom: 15px;
}
.winner-text {
font-size: 24px; font-weight: bold; color: #333; 
margin-bottom: 10px;
}
.final-scores {
display: flex; justify-content: space-around; margin: 20px 0;
}
.score-item {
text-align: center;
}
.score-label {
font-size: 12px; color: #666;
}
.score-value {
font-size: 24px;
font-weight: bold; color: #f5576c;
}
</style> 
</head> 
<body>
<!-- æˆ˜ç»©æ˜¾ç¤º-->
<div class="stats-container">
æˆ˜ç»©: <span class="win-stat" id="winCount">0</span> èƒœ / <span class="lose-stat" id="loseCount">0</span>è´Ÿ
</div>
<!-- æ¸¸æˆæ ‡é¢˜-->
<div class="game-title">Shut the Box</div>
<div class="game-container">
<!-- AI åŒºåŸŸ-->
<div class="player-section" id="aiSection">
<div class="player-header">
<div class="player-name">ğŸ¤–å‡¤ä¹æ­Œ</div> 
<div class="player-score"> åˆ† æ•° : <span id="aiScore">45</span></div>
</div> 
<div class="numbers-row" id="aiNumbers"></div> 
</div>

<!-- ä¸­å¤®éª°å­åŒºåŸŸ - åŒæ–¹å…±ç”¨-->
<div class="dice-center">
<div class="dice-container">
<div class="dice" id="dice1">?</div> 
<div class="dice" id="dice2">?</div> 
<div class="dice-sum" id="diceSum" style="display:none;">0</div>
</div>
<!-- é€‰ä¸­çš„æ•°å­—æ˜¾ç¤º-->
<div class="selected-display" id="selectedDisplay">
<span>å·²é€‰æ‹©ï¼š</span> <span id="selectedNumbers">æ— </span> 
</div>
<div class="controls">
<button class="btn btn-primary" id="startBtn">ğŸ®å¼€å§‹å›åˆ</button>
<button class="btn btn-success" id="confirmBtn" disabled>âœ“ç¡®è®¤</button>
<button class="btn btn-warning" id="clearBtn" disabled>ğŸ”„æ¸…ç©º</button>
</div> 
</div>

<!-- ç©å®¶åŒºåŸŸ-->
<div class="player-section active" id="playerSection">
<div class="player-header">
<div class="player-name">ğŸ‘¤ç©å®¶</div> 
<div class="player-score"> åˆ† æ•° : <span id="playerScore">45</span></div>
</div> 
<div class="numbers-row" id="playerNumbers"></div> 
</div>

<!-- çŠ¶æ€æ -->
<div class="status-bar">
å› åˆ <span id="turnCount">1</span> | å½“ å‰ : <span id="currentPlayer">ç©å®¶</span>
</div> 
</div>
<!-- è§„åˆ™æŒ‰é’®-->
<button class="rules-btn" onclick="showRules()">?</button>
<!-- è§„åˆ™å¼¹çª—-->
<div class="modal" id="rulesModal">
<div class="modal-content">
<div class="modal-title">ğŸ²æ¸¸æˆè§„åˆ™</div> 
<div class="modal-body">
<h3>æ¸¸æˆç›®æ ‡</h3> 
<p>æŠŠ1-9 è¿™9 å—æ•°å­—ç‰Œå°½é‡å…¨æŒ‰å€’ï¼Œè°æœ€åå‰©çš„ç‰Œé¢æ•°å­—æ€»å’Œæœ€å°ï¼Œè°å°±èµ¢ï¼</p>
<h3>æ¸¸æˆæµç¨‹</h3> 
<ul>
<li>ç©å®¶å…ˆæ·éª°å­ï¼Œé€‰æ‹©æ•°å­—</li> 
<li>ç„¶åAIæ·éª°å­ï¼Œé€‰æ‹©æ•°å­—</li> 
<li>å¯ä»¥ç¿»1 å¼ æˆ–å¤šå¼ ç‰Œ</li> 
<li>æ¯å›åˆç»“æŸåæ¯”è¾ƒåˆ†æ•°</li> 
</ul>
<h3>æ“ä½œè¯´æ˜</h3> 
<ul>
<li>ç‚¹å‡»æ•°å­—é€‰æ‹©/å–æ¶ˆé€‰æ‹©</li> 
<li>å¯ä»¥è¿ç»­é€‰æ‹©å¤šä¸ªæ•°å­—</li> 
<li>ç‚¹å‡»"æ¸…ç©º"å–æ¶ˆæ‰€æœ‰é€‰æ‹©</li> 
</ul>
<h3>è·èƒœæ¡ä»¶</h3> 
<ul>
<li>å…³é—­æ‰€æœ‰æ•°å­—ç›´æ¥è·èƒœ</li> 
<li>åŒæ–¹éƒ½æ— æ³•ç»§ç»­æ—¶ï¼Œå‰©ä½™åˆ†æ•°å°‘è€…è·èƒœ</li> 
<li>åŒæ–¹éƒ½æ— å¯ç”¨ç»„åˆæ—¶ï¼Œè‡ªåŠ¨é‡è¯•æœ€å¤š3æ¬¡</li> 
</ul>
<h3>ç¤ºä¾‹</h3> 
<p>æ·å‡º5+6=11ï¼Œ å¯ä»¥é€‰æ‹©ï¼š ç¿»2+9ï¼Œ æˆ–ç¿»1+2+8 ç­‰ä»»æ„ç»„åˆ</p> 
</div>
<button class="modal-close" onclick="hideRules()"> å¼€å§‹æ¸¸æˆ</button>
</div> 
</div>
<!-- æ¸¸æˆç»“æŸå¼¹çª—-->
<div class="game-over" id="gameOver">
<div class="game-over-content">
<div class="winner-icon" id="winnerIcon">ğŸ†</div>
<div class="winner-text" id="winnerText">æ¸¸æˆç»“æŸ</div> 
<div id="winnerMessage"></div> 
<div class="final-scores">
<div class="score-item">
<div class="score-label">ç©å®¶</div> 
<div class="score-value" id="finalPlayerScore">0</div> 
</div> 
<div class="score-item">
<div class="score-label">å‡¤ä¹æ­Œ</div> 
<div class="score-value" id="finalAiScore">0</div> 
</div> 
</div>
<button class="btn btn-primary" onclick="newGame()">å†æ¥ä¸€å±€</button>
</div> 
</div>
<script>
// æ¸¸æˆçŠ¶æ€ 
let game = {
currentPlayer: 'player', 
playerNumbers: [1,2,3,4,5,6,7,8,9], 
aiNumbers: [1,2,3,4,5,6,7,8,9], 
selected: [], 
// åŒæ–¹å„è‡ªçš„éª°å­æ•°å€¼ï¼ˆé€»è¾‘ä¸Šç‹¬ç«‹ï¼‰
playerDice1: 0, 
playerDice2: 0,
aiDice1: 0,
aiDice2: 0,
turn: 1, 
gameOver: false, 
turnActive: false,
retryCount: 0, // å½“å‰å›åˆé‡è¯•æ¬¡æ•°
maxRetries: 2  // æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆå…±3æ¬¡æœºä¼šï¼‰
};
// æˆ˜ç»©æ•°æ® 
let stats = {
wins: 0, 
losses: 0 
};
// åˆå§‹åŒ– 
function init() {
loadStats(); 
renderNumbers(); 
updateScores(); 
updateStatsDisplay();
// é¦–æ¬¡è¿›å…¥æ‰å¼¹è§„åˆ™ 
if (!localStorage.getItem('rulesShown')) {
showRules(); 
localStorage.setItem('rulesShown', 'true');
}
}
// åŠ è½½æˆ˜ç»©æ•°æ® 
function loadStats() {
const savedStats = localStorage.getItem('gameStats'); 
if (savedStats) {
stats = JSON.parse(savedStats);
}
}
// ä¿å­˜æˆ˜ç»©æ•°æ® 
function saveStats() {
localStorage.setItem('gameStats', JSON.stringify(stats));
}
// æ›´æ–°æˆ˜ç»©æ˜¾ç¤º 
function updateStatsDisplay() {
document.getElementById('winCount').textContent = stats.wins; 
document.getElementById('loseCount').textContent = stats.losses;
}
// ç»‘å®šäº‹ä»¶ 
document.getElementById('startBtn').onclick = startTurn;
document.getElementById('confirmBtn').onclick = confirmSelection; 
document.getElementById('clearBtn').onclick = clearSelection;
// æ˜¾ç¤ºè§„åˆ™ 
function showRules() {
document.getElementById('rulesModal').classList.add('show');
}
// éšè—è§„åˆ™ 
function hideRules() {
document.getElementById('rulesModal').classList.remove('show');
}
// é‡æ–°è®¾è®¡çš„æ¸²æŸ“å‡½æ•° 
function renderNumbers() {
// æ¸²æŸ“ç©å®¶æ•°å­— 
const playerDiv = document.getElementById('playerNumbers'); 
playerDiv.innerHTML = ''; 
for(let i = 1; i <= 9; i++) {
const box = document.createElement('div'); 
box.className = 'number-box'; 
box.textContent = i;
// æ£€æŸ¥æ˜¯å¦å·²å…³é—­ 
if(!game.playerNumbers.includes(i)) {
box.classList.add('closed');
}
// æ£€æŸ¥æ˜¯å¦è¢«é€‰ä¸­ 
else if(game.selected.includes(i)) {
box.classList.add('selected');
}
// åªæœ‰åœ¨ç©å®¶å›åˆä¸”æ•°å­—å¯ç”¨æ—¶æ‰èƒ½ç‚¹å‡» 
if(game.playerNumbers.includes(i) && game.turnActive && game.currentPlayer === 'player') {
box.onclick = () => selectNumber(i);
}
playerDiv.appendChild(box);
}
// æ¸²æŸ“AI æ•°å­—ï¼ˆæ˜¾ç¤ºå®é™…æ•°å­—ï¼‰ 
const aiDiv = document.getElementById('aiNumbers'); 
aiDiv.innerHTML = ''; 
for(let i = 1; i <= 9; i++) {
const box = document.createElement('div'); 
box.className = 'ai-number-box';
// æ˜¾ç¤ºå®é™…æ•°å­—ï¼Œè€Œä¸æ˜¯èƒŒé¢ç¬¦å· 
if(game.aiNumbers.includes(i)) {
box.textContent = i; // æ˜¾ç¤ºå®é™…æ•°å­— 
} else {
box.classList.add('closed');
box.textContent = i; // å…³é—­çš„æ•°å­—ä¹Ÿæ˜¾ç¤º
}
aiDiv.appendChild(box);
}
}
// å…¨æ–°çš„é€‰æ‹©é€»è¾‘ 
function selectNumber(num) {
// é˜²æŠ¤æ£€æŸ¥ 
if(!game.turnActive || game.currentPlayer !== 'player') return; 
if(!game.playerNumbers.includes(num)) return;
// æŸ¥æ‰¾æ•°å­—æ˜¯å¦å·²é€‰ä¸­ 
const index = game.selected.indexOf(num); 
if(index === -1) {
// æœªé€‰ä¸­-> æ·»åŠ åˆ°é€‰ä¸­åˆ—è¡¨ 
game.selected.push(num); 
} else {
// å·²é€‰ä¸­-> ä»é€‰ä¸­åˆ—è¡¨ç§»é™¤ 
game.selected.splice(index, 1);
}
// æ›´æ–°UI 
updateSelectionUI();
}
// æ›´æ–°é€‰æ‹©ç›¸å…³çš„UI 
function updateSelectionUI() {
// é‡æ–°æ¸²æŸ“æ•°å­—ä»¥åæ˜ é€‰ä¸­çŠ¶æ€ 
renderNumbers();
// æ›´æ–°é€‰ä¸­æ˜¾ç¤º 
const display = document.getElementById('selectedNumbers'); 
if(game.selected.length === 0) {
display.textContent = 'æ— '; 
} else {
display.innerHTML = game.selected.map(num => `<span class="selected-number">${num}</span>` ).join(' + ');
}
// æ£€æŸ¥é€‰æ‹©æ˜¯å¦æœ‰æ•ˆ 
checkSelection();
}
// æ£€æŸ¥é€‰æ‹© 
function checkSelection() {
const sum = game.selected.reduce((a,b) => a+b, 0); 
const diceSum = game.playerDice1 + game.playerDice2; // ä½¿ç”¨ç©å®¶çš„éª°å­
const isValid = sum === diceSum && game.selected.length > 0;
document.getElementById('confirmBtn').disabled = !isValid; 
document.getElementById('clearBtn').disabled = game.selected.length === 0;
}
// æ¸…ç©ºé€‰æ‹© 
function clearSelection() {
game.selected = []; 
updateSelectionUI();
}
// å¼€å§‹å›åˆ 
function startTurn() {
if(game.turnActive || game.gameOver) return;
game.turnActive = true;
game.selected = []; // æ¸…ç©ºä¹‹å‰çš„é€‰æ‹© 

// ç©å®¶æ·éª°å­
game.playerDice1 = Math.floor(Math.random() * 6) + 1;
game.playerDice2 = Math.floor(Math.random() * 6) + 1;
const dice1El = document.getElementById('dice1'); 
const dice2El = document.getElementById('dice2');
dice1El.classList.add('rolling'); 
dice2El.classList.add('rolling');

setTimeout(() => {
dice1El.classList.remove('rolling'); 
dice2El.classList.remove('rolling'); 
dice1El.textContent = game.playerDice1; 
dice2El.textContent = game.playerDice2;
const playerSum = game.playerDice1 + game.playerDice2; 
document.getElementById('diceSum').textContent = playerSum; 
document.getElementById('diceSum').style.display = 'inline-block';
document.getElementById('startBtn').disabled = true;

// æ£€æŸ¥ç©å®¶æ˜¯å¦æœ‰å¯ç”¨ç»„åˆ
const playerCanPlay = canPlay(game.playerNumbers, playerSum);

if(!playerCanPlay) {
showMessage('ç©å®¶æ²¡æœ‰å¯ç”¨ç»„åˆï¼Œè·³è¿‡å›åˆ');
setTimeout(() => {
// ç›´æ¥è¿›å…¥AIå›åˆ
aiTurnPhase();
}, 1500);
return;
}

// æ›´æ–°é€‰æ‹©UI 
updateSelectionUI();
}, 600);
}
// ç¡®è®¤é€‰æ‹© 
function confirmSelection() {
if(!game.turnActive || game.currentPlayer !== 'player') return;
const sum = game.selected.reduce((a,b) => a+b, 0); 
const diceSum = game.playerDice1 + game.playerDice2;
if(sum !== diceSum) return;
// ç§»é™¤é€‰ä¸­çš„æ•°å­— 
game.selected.forEach(num => {
const idx = game.playerNumbers.indexOf(num); 
if(idx > -1) game.playerNumbers.splice(idx, 1); 
});
game.selected = [];
// æ›´æ–°UI 
renderNumbers(); 
updateScores(); 
updateSelectionUI();
// æ£€æŸ¥ç©å®¶æ˜¯å¦å…³é—­æ‰€æœ‰æ•°å­— 
if(game.playerNumbers.length === 0) {
endGame('player'); // ç©å®¶èµ¢ 
return;
}
// é‡ç½®éª°å­æ˜¾ç¤º
resetDiceDisplay();
// è¿›å…¥AIå›åˆé˜¶æ®µ
aiTurnPhase();
}
// AIå›åˆé˜¶æ®µ
function aiTurnPhase() {
document.getElementById('currentPlayer').textContent = 'å‡¤ä¹æ­Œ'; 
document.getElementById('aiSection').classList.add('active');
document.getElementById('playerSection').classList.remove('active');

setTimeout(() => {
aiTurn(); 
}, 1000);
}
// AI å›åˆ 
function aiTurn() {
// AIæ·éª°å­
game.aiDice1 = Math.floor(Math.random() * 6) + 1;
game.aiDice2 = Math.floor(Math.random() * 6) + 1;
const dice1El = document.getElementById('dice1'); 
const dice2El = document.getElementById('dice2');
dice1El.classList.add('rolling'); 
dice2El.classList.add('rolling');

setTimeout(() => {
dice1El.classList.remove('rolling'); 
dice2El.classList.remove('rolling'); 
dice1El.textContent = game.aiDice1; 
dice2El.textContent = game.aiDice2;
const aiSum = game.aiDice1 + game.aiDice2; 
document.getElementById('diceSum').textContent = aiSum; 
document.getElementById('diceSum').style.display = 'inline-block';

const combo = findCombo(game.aiNumbers, aiSum);
if(combo) {
// æ˜¾ç¤ºAI é€‰æ‹©çš„æ•°å­— 
showMessage(`AI é€‰æ‹©äº†: ${combo.join(' + ')}`);
// ç›´æ¥ç§»é™¤æ•°å­— 
game.aiNumbers = game.aiNumbers.filter(num => !combo.includes(num));
renderNumbers(); 
updateScores();
// æ£€æŸ¥AI æ˜¯å¦å…³é—­æ‰€æœ‰æ•°å­— 
if(game.aiNumbers.length === 0) {
endGame('ai'); // AI èµ¢ 
return;
}
} else {
// AI æ²¡æœ‰å¯ç”¨ç»„åˆ
showMessage('AI æ²¡æœ‰å¯ç”¨ç»„åˆ');
}
// AI é€‰æ‹©åå›åˆç»“æŸ 
setTimeout(() => {
endTurn(); 
}, 2000);
}, 600);
}
// å›åˆç»“æŸ 
function endTurn() {
game.turnActive = false; 
game.turn++;

// æ£€æŸ¥åŒæ–¹æ˜¯å¦éƒ½æœ‰å¯ç”¨ç»„åˆ
const playerCanPlay = canPlay(game.playerNumbers, 12);
const aiCanPlay = canPlay(game.aiNumbers, 12);

if(!playerCanPlay && !aiCanPlay) {
// åŒæ–¹éƒ½æ— æ³•æ“ä½œ â†’ æ£€æŸ¥é‡è¯•æ¬¡æ•°
if(game.retryCount < game.maxRetries) {
game.retryCount++;
showMessage(`åŒæ–¹æ— å¯ç”¨ç»„åˆï¼Œé‡è¯•ä¸­ (${game.retryCount}/${game.maxRetries})`);
setTimeout(() => startTurn(), 1500); // è‡ªåŠ¨é‡è¯•
return;
} else {
// é‡è¯•æ¬¡æ•°ç”¨å®Œ â†’ ç»“æŸæ¸¸æˆæ¯”è¾ƒåˆ†æ•°
endGame(); // ä¸ä¼ å‚æ•°ï¼Œè¿›å…¥åˆ†æ•°æ¯”è¾ƒé€»è¾‘
return;
}
}

// é‡ç½®é‡è¯•è®¡æ•°å™¨ï¼ˆæœ‰å¯ç”¨ç»„åˆæ—¶ï¼‰
game.retryCount = 0;

// é‡ç½®UI
resetUI();
updateSelectionUI();
}
// é‡ç½®éª°å­æ˜¾ç¤º
function resetDiceDisplay() {
document.getElementById('dice1').textContent = '?';
document.getElementById('dice2').textContent = '?';
document.getElementById('diceSum').style.display = 'none';
}
// é‡ç½®UI
function resetUI() {
document.getElementById('aiSection').classList.remove('active'); 
document.getElementById('playerSection').classList.add('active'); 
document.getElementById('currentPlayer').textContent = 'ç©å®¶'; 
document.getElementById('turnCount').textContent = game.turn; 
document.getElementById('startBtn').disabled = false; 
resetDiceDisplay();
document.getElementById('confirmBtn').disabled = true; 
document.getElementById('clearBtn').disabled = true;
}
// æŸ¥æ‰¾ç»„åˆ 
function findCombo(numbers, target) {
if(numbers.includes(target)) return [target];
for(let i = 0; i < numbers.length; i++) {
for(let j = i + 1; j < numbers.length; j++) {
if(numbers[i] + numbers[j] === target) return [numbers[i], numbers[j]];
}
}
for(let k = 3; k <= numbers.length; k++) {
const combo = findKCombo(numbers, k, target); 
if(combo) return combo;
}
return null;
}
function findKCombo(numbers, k, target) {
if(k === 0) return target === 0 ? [] : null; 
if(numbers.length < k) return null;
for(let i = 0; i < numbers.length; i++) {
const rest = numbers.slice(i + 1); 
const combo = findKCombo(rest, k - 1, target - numbers[i]); 
if(combo) return [numbers[i], ...combo];
}
return null;
}
// æ£€æŸ¥æ˜¯å¦èƒ½ç© 
function canPlay(numbers, target) {
return findCombo(numbers, target) !== null;
}
// æ›´æ–°åˆ†æ•° 
function updateScores() {
const playerScore = game.playerNumbers.reduce((a,b) => a+b, 0);
const aiScore = game.aiNumbers.reduce((a,b) => a+b, 0);
document.getElementById('playerScore').textContent = playerScore;
document.getElementById('aiScore').textContent = aiScore;
}
// æ¸¸æˆç»“æŸ 
function endGame(winner) {
game.gameOver = true;
const playerScore = game.playerNumbers.reduce((a,b) => a+b, 0);
const aiScore = game.aiNumbers.reduce((a,b) => a+b, 0);
let icon, text, message;
if(winner === 'player') {
icon = 'ğŸ‰';
text = 'ä½ èµ¢äº†ï¼';
message = playerScore === 0 ? 'å®Œç¾å…³é—­æ‰€æœ‰æ•°å­—ï¼' : `åˆ†æ•° ${playerScore} vs ${aiScore}`;
stats.wins++; 
} else if(winner === 'ai') {
icon = 'ğŸ¤–';
text = 'å‡¤ä¹æ­Œèµ¢äº†ï¼';
message = aiScore === 0 ? 'AI å®Œç¾å…³é—­æ‰€æœ‰æ•°å­—ï¼' : `åˆ†æ•° ${aiScore} vs ${playerScore}`;
stats.losses++; 
} else if(winner === 'draw') {
icon = 'ğŸ¤';
text = 'å¹³å±€ï¼';
message = `åŒæ–¹éƒ½æ˜¯ ${playerScore} åˆ†`;
} 
// æœªæŒ‡å®šè·èƒœè€… â†’ æ¯”è¾ƒåˆ†æ•°
else {
if(playerScore < aiScore) {
icon = 'ğŸ†';
text = 'ä½ èµ¢äº†ï¼';
message = `åˆ†æ•° ${playerScore} vs ${aiScore}`;
stats.wins++;
} else if(playerScore > aiScore) {
icon = 'ğŸ¤–';
text = 'å‡¤ä¹æ­Œèµ¢äº†ï¼';
message = `åˆ†æ•° ${aiScore} vs ${playerScore}`;
stats.losses++;
} else {
icon = 'ğŸ¤';
text = 'å¹³å±€ï¼';
message = `åŒæ–¹éƒ½æ˜¯ ${playerScore} åˆ†`;
}
}
// ä¿å­˜æˆ˜ç»© 
saveStats(); 
updateStatsDisplay();
document.getElementById('winnerIcon').textContent = icon; 
document.getElementById('winnerText').textContent = text;
document.getElementById('winnerMessage').textContent = message;
document.getElementById('finalPlayerScore').textContent = playerScore;
document.getElementById('finalAiScore').textContent = aiScore; 
document.getElementById('gameOver').classList.add('show');
}
// æ–°æ¸¸æˆ 
function newGame() {
game = {
currentPlayer: 'player', 
playerNumbers: [1,2,3,4,5,6,7,8,9], 
aiNumbers: [1,2,3,4,5,6,7,8,9], 
selected: [], 
playerDice1: 0, 
playerDice2: 0,
aiDice1: 0,
aiDice2: 0,
turn: 1, 
gameOver: false, 
turnActive: false,
retryCount: 0, // é‡ç½®é‡è¯•è®¡æ•°å™¨
maxRetries: 2
};
document.getElementById('gameOver').classList.remove('show'); 
document.getElementById('playerSection').classList.add('active'); 
document.getElementById('aiSection').classList.remove('active'); 
document.getElementById('currentPlayer').textContent = 'ç©å®¶';
document.getElementById('turnCount').textContent = '1'; 
resetDiceDisplay();
document.getElementById('startBtn').disabled = false; 
document.getElementById('confirmBtn').disabled = true; 
document.getElementById('clearBtn').disabled = true;
updateSelectionUI(); 
renderNumbers(); 
updateScores();
}
// æ˜¾ç¤ºæ¶ˆæ¯ 
function showMessage(text) {
const msg = document.createElement('div'); 
msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:15px 30px;border-radius:10px;z-index:999;';
msg.textContent = text; 
document.body.appendChild(msg); 
setTimeout(() => msg.remove(), 2000);
}
// å¯åŠ¨æ¸¸æˆ 
init(); 
</script> 
</body> 
</html>
